import{r as d,f as m,g as H,o as r,c as i,a as e,t as l,w as f,k as U,v as A,q as I,F as B,i as L,b as S,j as J,m as c,n as $}from"./index-621cd5fc.js";import{c as M}from"./complaints-a2612d46.js";import{_ as K}from"./LoadingSpinner-93693765.js";import"./http-f1abb376.js";const W={class:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8"},X={class:"max-w-7xl mx-auto"},Z={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},ee={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},se={class:"flex items-center"},te={class:"ml-4"},oe={class:"text-2xl font-bold text-gray-900"},le={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ne={class:"flex items-center"},ae={class:"ml-4"},re={class:"text-2xl font-bold text-gray-900"},de={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ie={class:"flex items-center"},ue={class:"ml-4"},ce={class:"text-2xl font-bold text-gray-900"},me={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ge={class:"flex items-center"},pe={class:"ml-4"},be={class:"text-2xl font-bold text-gray-900"},ve={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6"},xe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ye={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},fe={key:1,class:"text-center py-12"},he={key:2,class:"divide-y divide-gray-200"},_e={class:"flex items-start justify-between"},we={class:"flex-1"},Ce={class:"flex items-center space-x-3 mb-2"},ke={class:"text-sm text-gray-500"},Re={class:"mb-3"},Se={class:"text-sm font-medium text-gray-900"},Me={class:"text-xs text-gray-500"},Ve={class:"mb-3"},Fe={class:"text-gray-800 whitespace-pre-wrap"},Pe={key:0,class:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded"},De={class:"text-sm text-blue-800"},Ue={class:"ml-4 flex flex-col space-y-2"},Ae=["onClick"],Be=["onClick"],Le=["onClick"],$e={key:3,class:"border-t border-gray-200 px-6 py-4 bg-gray-50"},je={class:"flex items-center justify-between"},Ee={class:"text-sm text-gray-700"},Ne={class:"flex space-x-2"},Te=["disabled"],ze=["onClick"],qe=["disabled"],Oe={class:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4"},Qe={class:"p-6"},Ye={class:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4"},Ge={class:"text-sm text-gray-600"},He={class:"mb-4"},Ie={class:"mb-6"},Je={class:"flex justify-end space-x-3"},Ke=["disabled"],h=10,ts={__name:"AdminComplaintsView",setup(We){const _=d(!0),g=d([]),w=d("all"),C=d(""),V=d("newest"),u=d(1),F=d(!1),k=d(null),p=d(""),b=d("pending"),R=d(!1),j=m(()=>g.value.filter(o=>o.status==="pending").length),E=m(()=>g.value.filter(o=>o.status==="resolved").length),N=m(()=>g.value.filter(o=>o.status==="closed").length),v=m(()=>{let o=g.value;if(w.value!=="all"&&(o=o.filter(s=>s.status===w.value)),C.value){const s=C.value.toLowerCase();o=o.filter(n=>{var t,a,y;return((t=n.complaint)==null?void 0:t.toLowerCase().includes(s))||((a=n.user_name)==null?void 0:a.toLowerCase().includes(s))||((y=n.user_email)==null?void 0:y.toLowerCase().includes(s))})}return o=[...o].sort((s,n)=>{const t=new Date(s.inserted_at),a=new Date(n.inserted_at);return V.value==="newest"?a-t:t-a}),o}),P=m(()=>Math.ceil(v.value.length/h)),T=m(()=>{const o=(u.value-1)*h,s=o+h;return v.value.slice(o,s)}),z=m(()=>{const o=[];let n=Math.max(1,u.value-Math.floor(2.5)),t=Math.min(P.value,n+5-1);t-n<5-1&&(n=Math.max(1,t-5+1));for(let a=n;a<=t;a++)o.push(a);return o}),x=async()=>{try{_.value=!0;const o=await M.list();g.value=o.data||[],c.success("Complaints loaded successfully")}catch(o){console.error("Error loading complaints:",o),c.error("Failed to load complaints")}finally{_.value=!1}},q=o=>{k.value=o,p.value=o.admin_response||"",b.value=o.status||"pending",F.value=!0},D=()=>{F.value=!1,k.value=null,p.value="",b.value="pending"},O=async()=>{try{R.value=!0,await M.update(k.value.id,{status:b.value,admin_response:p.value}),c.success("Response submitted successfully"),D(),await x()}catch(o){console.error("Error submitting response:",o),c.error("Failed to submit response")}finally{R.value=!1}},Q=async o=>{if(confirm("Are you sure you want to delete this complaint? This action cannot be undone."))try{await M.delete(o),c.success("Complaint deleted successfully"),await x()}catch(s){console.error("Error deleting complaint:",s),c.error("Failed to delete complaint")}},Y=async o=>{if(confirm("Are you sure you want to mark this complaint as resolved?"))try{await M.update(o,{status:"resolved"}),c.success("Complaint marked as resolved"),await x()}catch(s){console.error("Error resolving complaint:",s),c.error("Failed to resolve complaint")}},G=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return H(()=>{x()}),(o,s)=>{var n;return r(),i("div",W,[e("div",X,[e("div",{class:"mb-8"},[e("div",{class:"flex items-center justify-between"},[s[7]||(s[7]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"ðŸ“ Complaints Management"),e("p",{class:"text-gray-600"},"View and respond to user complaints")],-1)),e("button",{onClick:x,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700"}," ðŸ”„ Refresh ")])]),e("div",Z,[e("div",ee,[e("div",se,[s[9]||(s[9]=e("div",{class:"p-3 bg-yellow-100 rounded-lg"},[e("span",{class:"text-2xl"},"â³")],-1)),e("div",te,[s[8]||(s[8]=e("p",{class:"text-sm font-medium text-gray-500"},"Pending",-1)),e("p",oe,l(j.value),1)])])]),e("div",le,[e("div",ne,[s[11]||(s[11]=e("div",{class:"p-3 bg-green-100 rounded-lg"},[e("span",{class:"text-2xl"},"âœ…")],-1)),e("div",ae,[s[10]||(s[10]=e("p",{class:"text-sm font-medium text-gray-500"},"Resolved",-1)),e("p",re,l(E.value),1)])])]),e("div",de,[e("div",ie,[s[13]||(s[13]=e("div",{class:"p-3 bg-red-100 rounded-lg"},[e("span",{class:"text-2xl"},"ðŸ”’")],-1)),e("div",ue,[s[12]||(s[12]=e("p",{class:"text-sm font-medium text-gray-500"},"Closed",-1)),e("p",ce,l(N.value),1)])])]),e("div",me,[e("div",ge,[s[15]||(s[15]=e("div",{class:"p-3 bg-blue-100 rounded-lg"},[e("span",{class:"text-2xl"},"ðŸ“Š")],-1)),e("div",pe,[s[14]||(s[14]=e("p",{class:"text-sm font-medium text-gray-500"},"Total",-1)),e("p",be,l(g.value.length),1)])])])]),e("div",ve,[e("div",xe,[e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status Filter",-1)),f(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>w.value=t),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...s[16]||(s[16]=[e("option",{value:"all"},"All Status",-1),e("option",{value:"pending"},"Pending",-1),e("option",{value:"resolved"},"Resolved",-1),e("option",{value:"closed"},"Closed",-1)])],512),[[U,w.value]])]),e("div",null,[s[18]||(s[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search",-1)),f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>C.value=t),type:"text",placeholder:"Search complaints...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},null,512),[[A,C.value]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sort By",-1)),f(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>V.value=t),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...s[19]||(s[19]=[e("option",{value:"newest"},"Newest First",-1),e("option",{value:"oldest"},"Oldest First",-1)])],512),[[U,V.value]])])])]),e("div",ye,[_.value?(r(),I(K,{key:0,show:_.value,text:"Loading complaints..."},null,8,["show"])):v.value.length===0?(r(),i("div",fe,[...s[21]||(s[21]=[e("span",{class:"text-6xl mb-4 block"},"ðŸ“­",-1),e("p",{class:"text-gray-500 text-lg"},"No complaints found",-1)])])):(r(),i("div",he,[(r(!0),i(B,null,L(T.value,t=>{var a;return r(),i("div",{key:t.id,class:"p-6 hover:bg-gray-50 transition-colors"},[e("div",_e,[e("div",we,[e("div",Ce,[e("span",{class:$(["px-3 py-1 text-xs font-medium rounded-full",{"bg-yellow-100 text-yellow-800":t.status==="pending","bg-green-100 text-green-800":t.status==="resolved","bg-gray-100 text-gray-800":t.status==="closed"}])},l((a=t.status)==null?void 0:a.toUpperCase()),3),e("span",ke,l(G(t.inserted_at)),1)]),e("div",Re,[e("p",Se," ðŸ‘¤ "+l(t.user_name),1),e("p",Me,l(t.user_email)+" â€¢ "+l(t.user_role),1)]),e("div",Ve,[e("p",Fe,l(t.complaint),1)]),t.admin_response?(r(),i("div",Pe,[s[22]||(s[22]=e("p",{class:"text-sm font-medium text-blue-900 mb-1"},"Admin Response:",-1)),e("p",De,l(t.admin_response),1)])):S("",!0)]),e("div",Ue,[e("button",{onClick:y=>q(t),class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700"}," ðŸ’¬ Respond ",8,Ae),t.status==="pending"?(r(),i("button",{key:0,onClick:y=>Y(t.id),class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700"}," âœ… Resolve ",8,Be)):S("",!0),e("button",{onClick:y=>Q(t.id),class:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700"}," ðŸ—‘ï¸ Delete ",8,Le)])])])}),128))])),P.value>1?(r(),i("div",$e,[e("div",je,[e("p",Ee," Showing "+l((u.value-1)*h+1)+" to "+l(Math.min(u.value*h,v.value.length))+" of "+l(v.value.length)+" complaints ",1),e("div",Ne,[e("button",{onClick:s[3]||(s[3]=t=>u.value--),disabled:u.value===1,class:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-white disabled:opacity-50"}," Previous ",8,Te),(r(!0),i(B,null,L(z.value,t=>(r(),i("button",{key:t,onClick:a=>u.value=t,class:$(["px-3 py-1 border rounded-lg",u.value===t?"bg-blue-600 text-white border-blue-600":"border-gray-300 hover:bg-white"])},l(t),11,ze))),128)),e("button",{onClick:s[4]||(s[4]=t=>u.value++),disabled:u.value===P.value,class:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-white disabled:opacity-50"}," Next ",8,qe)])])])):S("",!0)])]),F.value?(r(),i("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:J(D,["self"])},[e("div",Oe,[s[27]||(s[27]=e("div",{class:"bg-gradient-to-r from-blue-500 to-indigo-500 p-6 rounded-t-xl"},[e("h3",{class:"text-2xl font-bold text-white"},"Respond to Complaint")],-1)),e("div",Qe,[e("div",Ye,[s[23]||(s[23]=e("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Original Complaint:",-1)),e("p",Ge,l((n=k.value)==null?void 0:n.complaint),1)]),e("div",He,[s[25]||(s[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Update Status",-1)),f(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>b.value=t),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...s[24]||(s[24]=[e("option",{value:"pending"},"Pending",-1),e("option",{value:"resolved"},"Resolved",-1),e("option",{value:"closed"},"Closed",-1)])],512),[[U,b.value]])]),e("div",Ie,[s[26]||(s[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Your Response",-1)),f(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=t=>p.value=t),rows:"4",placeholder:"Enter your response...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-none"},null,512),[[A,p.value]])]),e("div",Je,[e("button",{onClick:D,class:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"}," Cancel "),e("button",{onClick:O,disabled:R.value||!p.value,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},l(R.value?"Submitting...":"Submit Response"),9,Ke)])])])])):S("",!0)])}}};export{ts as default};
