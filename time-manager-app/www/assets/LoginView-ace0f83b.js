import{o as d,c as u,a as e,b as f,F as k,r as C,t as g,n as U,w as E,v as z,d as _,e as S,u as B,f as x,g as A,h as M,i as L,j as V,k as R}from"./index-cca8f33b.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";const F={name:"LoginPage",props:{users:{type:Array,default:()=>[]},usersLoading:{type:Boolean,default:!1},usersError:{type:String,default:""},loginError:{type:String,default:""}},data(){return{selectedUser:null,signinForm:{password:""}}},methods:{initials(o){return o?(o.first_name||o.username||o.email||"").split(" ").map(l=>l?l[0].toUpperCase():"").slice(0,2).join(""):"??"},displayName(o){return o?o.first_name||o.username||o.email||"User":"Unknown User"},selectUser(o){this.selectedUser=o,this.signinForm.password="",this.$nextTick(()=>{const t=document.getElementById("signin_password");t&&t.focus()})},async testBackendConnection(){console.log("--- Bouton cliqué : Tentative de connexion au backend... ---");try{console.log("🔄 Tentative de requête vers l'URL :","http://10.68.247.105:4000/api/users");const o=await fetch("http://10.68.247.105:4000/api/users");if(console.log("Réponse brute reçue, statut :",o.status),o.ok){const t=await o.json();console.log("✅ SUCCÈS ! Données reçues :",t),alert("Connexion au backend RÉUSSIE ! Vérifiez la console.")}else console.error("❌ ERREUR : Le serveur a répondu avec un statut d'échec :",o.status),alert(`ERREUR : Le serveur a répondu avec le code ${o.status}. Vérifiez la console.`)}catch(o){console.error("❌ ÉCHEC TOTAL : Impossible de joindre le serveur. L'URL est-elle correcte ? Le serveur est-il démarré ? Le téléphone est-il sur le bon WiFi ?",o),alert("ÉCHEC TOTAL de la connexion. Vérifiez la console pour les détails.")}},handleSignin(){!this.selectedUser||!this.signinForm.password||this.$emit("signin",{email:this.selectedUser.email,password:this.signinForm.password})}},watch:{selectedUser(){this.signinForm.password=""},users(){this.selectedUser=null}}},T={class:"space-y-6"},H={key:0},N={class:"mt-4"},P={key:0,class:"space-y-4"},I={key:1,class:"rounded-md bg-red-50 p-4 mb-4"},D={class:"flex"},q={class:"ml-3"},O={class:"text-sm font-medium text-red-800"},W={key:2,class:"space-y-3"},$=["onClick"],G={class:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-medium"},J={class:"ml-4 text-left flex-1 min-w-0"},K={class:"flex items-center justify-between"},Q={class:"text-sm font-medium text-gray-900 truncate"},X={class:"text-sm text-gray-500 truncate"},Y={key:3,class:"text-center py-8"},Z={class:"mt-6"},ee={key:1},te={class:"flex items-center justify-between mb-6"},se={class:"flex items-center p-4 bg-indigo-50 rounded-lg mb-6"},oe={class:"flex-shrink-0 h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-medium text-lg"},re={class:"ml-4"},ne={class:"text-sm font-medium text-gray-900"},ie={class:"text-sm text-gray-500"},le={class:"mt-1 relative rounded-md shadow-sm"},ae={key:0,class:"mt-1 text-sm text-red-600"},de=["disabled"];function ue(o,t,l,y,a,c){return d(),u("div",T,[a.selectedUser?(d(),u("div",ee,[e("div",te,[t[13]||(t[13]=e("h2",{class:"text-2xl font-bold text-gray-900"},"Welcome back",-1)),e("button",{type:"button",onClick:t[2]||(t[2]=s=>a.selectedUser=null),class:"text-sm font-medium text-indigo-600 hover:text-indigo-500 focus:outline-none"}," Change user ")]),e("div",se,[e("div",oe,g(c.initials(a.selectedUser)),1),e("div",re,[e("p",ne,g(c.displayName(a.selectedUser)),1),e("p",ie,g(a.selectedUser.email),1)])]),e("form",{onSubmit:t[4]||(t[4]=S((...s)=>c.handleSignin&&c.handleSignin(...s),["prevent"])),class:"space-y-6"},[e("div",null,[t[15]||(t[15]=e("label",{for:"signin_password",class:"block text-sm font-medium text-gray-700 mb-1"}," Password ",-1)),e("div",le,[E(e("input",{id:"signin_password","onUpdate:modelValue":t[3]||(t[3]=s=>a.signinForm.password=s),type:"password",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200",placeholder:"Enter your password"},null,512),[[z,a.signinForm.password]]),t[14]||(t[14]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})])],-1))]),l.loginError?(d(),u("div",ae,g(l.loginError),1)):_("",!0),t[16]||(t[16]=e("div",{class:"mt-2 text-right"},[e("a",{href:"#",class:"text-sm font-medium text-indigo-600 hover:text-indigo-500"}," Forgot password? ")],-1))]),e("div",null,[e("button",{type:"submit",class:U(["w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-blue-700 hover:from-indigo-700 hover:to-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200",{"opacity-75 cursor-not-allowed":!a.signinForm.password}]),disabled:!a.signinForm.password},[...t[17]||(t[17]=[e("svg",{class:"h-5 w-5 mr-2 -ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})],-1),f(" Sign in ",-1)])],10,de)])],32)])):(d(),u("div",H,[t[12]||(t[12]=e("div",{class:"text-center mb-6"},[e("h2",{class:"text-2xl font-bold text-gray-900"},"Select an account test"),e("p",{class:"mt-1 text-sm text-gray-500"},"Choose an account to continue")],-1)),e("div",N,[e("button",{type:"button",onClick:t[0]||(t[0]=s=>c.testBackendConnection()),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[...t[5]||(t[5]=[e("svg",{class:"-ml-0.5 mr-2 h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1),f(" Refresh List ",-1)])])]),l.usersLoading?(d(),u("div",P,[(d(),u(k,null,C(3,s=>e("div",{key:`skeleton-${s}`,class:"animate-pulse"},[...t[6]||(t[6]=[e("div",{class:"h-16 bg-gray-100 rounded-lg"},null,-1)])])),64))])):l.usersError?(d(),u("div",I,[e("div",D,[t[7]||(t[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",q,[e("h3",O,g(l.usersError),1)])])])):l.users&&l.users.length?(d(),u("div",W,[(d(!0),u(k,null,C(l.users,(s,p)=>{var h,w;return d(),u("button",{key:p,onClick:b=>c.selectUser(s),class:"w-full flex items-center p-4 rounded-lg border border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-colors duration-200"},[e("div",G,g(c.initials(s)),1),e("div",J,[e("div",K,[e("p",Q,g(c.displayName(s)),1),e("span",{class:U(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-purple-100 text-purple-800":((h=s.role)==null?void 0:h.toLowerCase())==="admin","bg-blue-100 text-blue-800":((w=s.role)==null?void 0:w.toLowerCase())==="user","bg-gray-100 text-gray-800":!s.role}])},g(s.role?s.role.toUpperCase():"USER"),3)]),e("p",X,g(s.email),1)])],8,$)}),128))])):(d(),u("div",Y,[t[9]||(t[9]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)),t[10]||(t[10]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No users found",-1)),t[11]||(t[11]=e("p",{class:"mt-1 text-sm text-gray-500"}," Get started by creating a new account. ",-1)),e("div",Z,[e("button",{type:"button",onClick:t[1]||(t[1]=s=>o.$emit("switch-page","signup")),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[...t[8]||(t[8]=[e("svg",{class:"-ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),f(" New Account ",-1)])])])]))]))])}const ce=j(F,[["render",ue],["__scopeId","data-v-d295c9fc"]]),ge={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4"},me={class:"w-full max-w-md"},ve={class:"text-center mb-8"},fe={key:0,class:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg"},xe={class:"flex"},pe={class:"ml-3"},he={class:"text-sm font-medium text-green-800"},we={key:0,class:"text-sm text-green-700 mt-1"},ye={class:"bg-white rounded-xl shadow-md overflow-hidden"},be={class:"p-8"},_e={class:"mt-6 text-center"},ke={class:"text-sm text-gray-600"},Se={__name:"LoginView",setup(o){const t=B(),l=x(!1),y=x(""),a=x(""),c=x(!1),s=x(null),p=x([]);A(async()=>{l.value=!0;try{const i=await M.list();p.value=Array.isArray(i)?i:Array.isArray(i==null?void 0:i.data)?i.data:[]}catch{y.value="Failed to load users"}finally{l.value=!1}});const h=async({email:i,password:n})=>{if(a.value="",c.value=!1,!i||!n){a.value="Please enter both email and password";return}try{if(!await w(i,n)){a.value="Invalid email or password";return}const r=p.value.find(v=>v.email===i);if(r){const v={id:r.id,email:r.email,username:r.username,first_name:r.first_name,last_name:r.last_name,role:r.role};localStorage.setItem("currentUser",JSON.stringify(v)),s.value=v}c.value=!0,setTimeout(()=>t.push("/dashboard"),1500)}catch(m){console.error("Login error:",m),a.value=m.message||"An error occurred during login. Please try again."}},w=async(i,n)=>{var m;try{const r=await R.post("/api/sessions",{email:i,password:n});return(m=r==null?void 0:r.data)!=null&&m.token?(localStorage.setItem("authToken",r.data.token),!0):!1}catch(r){throw console.error("Authentication error:",r),r}},b=i=>{i==="signup"&&t.push("/signup")};return(i,n)=>{var m,r,v;return d(),u("div",ge,[e("div",me,[e("div",ve,[n[3]||(n[3]=L('<div class="mx-auto w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><h1 class="text-3xl font-bold text-gray-900 mb-2">Time Manager</h1><p class="text-gray-600">Sign in to access your dashboard</p>',3)),c.value?(d(),u("div",fe,[e("div",xe,[n[2]||(n[2]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-green-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),e("div",pe,[e("p",he," Welcome back, "+g(((m=s.value)==null?void 0:m.first_name)||((r=s.value)==null?void 0:r.username)||"User")+"! ",1),(v=s.value)!=null&&v.role?(d(),u("p",we," Role: "+g(s.value.role.toUpperCase()),1)):_("",!0),n[1]||(n[1]=L('<p class="text-sm text-green-700 mt-2"><span class="inline-flex items-center"><svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Redirecting... </span></p>',1))])])])):_("",!0)]),e("div",ye,[e("div",be,[V(ce,{users:p.value,usersLoading:l.value,usersError:y.value,loginError:a.value,onSignin:h,onSwitchPage:b},null,8,["users","usersLoading","usersError","loginError"])]),n[4]||(n[4]=e("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200"},[e("p",{class:"text-xs text-center text-gray-500"},[f(" By signing in, you agree to our "),e("a",{href:"#",class:"text-indigo-600 hover:text-indigo-500 font-medium"},"Terms"),f(" and "),e("a",{href:"#",class:"text-indigo-600 hover:text-indigo-500 font-medium"},"Privacy Policy"),f(". ")])],-1))]),e("div",_e,[e("p",ke,[n[5]||(n[5]=f(" Don't have an account? ",-1)),e("a",{href:"#",onClick:n[0]||(n[0]=S(Ce=>b("signup"),["prevent"])),class:"font-medium text-indigo-600 hover:text-indigo-500"}," Sign up for free ")])])])])}}};export{Se as default};
