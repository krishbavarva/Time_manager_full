import{x as E,r as u,f as F,g as N,o,c as a,a as e,w as k,v as h,t as l,j as P,b as d,F as S,i as $,n as D}from"./index-621cd5fc.js";import{h as c}from"./http-f1abb376.js";const j={list:()=>c.get("/api/overtime_requests"),get:n=>c.get(`/api/overtime_requests/${n}`),create:n=>c.post("/api/overtime_requests",{overtime_request:n}),update:(n,v)=>c.put(`/api/overtime_requests/${n}`,{overtime_request:v}),delete:n=>c.delete(`/api/overtime_requests/${n}`),getByUser:n=>c.get(`/api/overtime_requests?user_id=${n}`),getPending:()=>c.get("/api/overtime_requests?status=pending")};const B={class:"p-6 max-w-7xl mx-auto bg-white"},H={key:0,class:"card mb-6"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},I={class:"flex justify-end space-x-3"},T=["disabled"],z={key:1,class:"card mb-6"},J={key:0,class:"text-gray-500 text-center py-4"},G={key:1,class:"space-y-4"},K={class:"flex justify-between items-start"},Q={class:"flex-1"},W={class:"font-medium text-gray-900"},X={class:"text-sm text-gray-600"},Y={key:0,class:"text-sm text-gray-500"},Z={class:"text-sm text-gray-700 mt-2"},ee={class:"flex space-x-2"},te=["onClick","disabled"],se=["onClick","disabled"],oe={class:"card"},ae={key:0,class:"text-center py-4"},re={key:1,class:"text-gray-500 text-center py-4"},le={key:2},ne={class:"table"},ie={key:0},de={key:1},ue={key:0},ce={key:1},ve={key:0,class:"flex space-x-2"},me=["onClick"],pe=["onClick"],ye={__name:"OvertimeManagementView",setup(n){const v=u([]),w=u([]),R=u(!1),b=u(!1),m=u(!1),x=u(""),i=u({date:"",hours:1,reason:"",project:""}),_=JSON.parse(localStorage.getItem("currentUser")||"{}"),C=F(()=>{var r;return((r=_.role)==null?void 0:r.toLowerCase())||"employee"}),p=F(()=>["admin","manager"].includes(C.value)),f=async()=>{R.value=!0;try{const r=await j.list();v.value=r.data||[],p.value&&(w.value=v.value.filter(t=>t.status==="pending"))}catch(r){x.value="Failed to load overtime requests",console.error("Error loading overtime requests:",r)}finally{R.value=!1}},U=async()=>{var r,t;b.value=!0;try{const s={...i.value,user_id:_.id};await j.create(s),V(),await f()}catch(s){x.value=((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.error)||"Failed to submit overtime request",console.error("Error submitting overtime request:",s)}finally{b.value=!1}},O=async r=>{m.value=!0;try{await j.update(r,{status:"approved",approved_by_id:_.id}),await f()}catch(t){x.value="Failed to approve request",console.error("Error approving request:",t)}finally{m.value=!1}},M=async r=>{m.value=!0;try{await j.update(r,{status:"rejected",approved_by_id:_.id}),await f()}catch(t){x.value="Failed to reject request",console.error("Error rejecting request:",t)}finally{m.value=!1}},V=()=>{i.value={date:"",hours:1,reason:"",project:""}},A=r=>({pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"})[r]||"bg-gray-100 text-gray-800";return N(f),(r,t)=>(o(),a("section",B,[t[16]||(t[16]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Overtime Management"),e("p",{class:"text-gray-600 mt-1"},"Manage overtime requests and approvals")],-1)),C.value==="employee"?(o(),a("div",H,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Request Overtime",-1)),e("form",{onSubmit:P(U,["prevent"]),class:"space-y-4"},[e("div",L,[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date",-1)),k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>i.value.date=s),type:"date",required:"",class:"form-control"},null,512),[[h,i.value.date]])]),e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Hours",-1)),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.value.hours=s),type:"number",min:"0.5",step:"0.5",required:"",class:"form-control"},null,512),[[h,i.value.hours,void 0,{number:!0}]])])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Reason",-1)),k(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.value.reason=s),required:"",rows:"3",class:"form-control",placeholder:"Please provide a reason for overtime work"},null,512),[[h,i.value.reason]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Project/Task",-1)),k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.value.project=s),type:"text",class:"form-control",placeholder:"Optional: specify project or task"},null,512),[[h,i.value.project]])]),e("div",I,[e("button",{type:"button",onClick:V,class:"btn-secondary"},"Reset"),e("button",{type:"submit",disabled:b.value,class:"btn-primary"},l(b.value?"Submitting...":"Submit Request"),9,T)])],32)])):d("",!0),p.value?(o(),a("div",z,[t[9]||(t[9]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Pending Overtime Approvals",-1)),w.value.length===0?(o(),a("div",J," No pending overtime requests ")):(o(),a("div",G,[(o(!0),a(S,null,$(w.value,s=>{var y,g;return o(),a("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4"},[e("div",K,[e("div",Q,[e("h3",W,l((y=s.user)==null?void 0:y.first_name)+" "+l((g=s.user)==null?void 0:g.last_name),1),e("p",X,l(s.hours)+" hours on "+l(s.date),1),s.project?(o(),a("p",Y,"Project: "+l(s.project),1)):d("",!0),e("p",Z,l(s.reason),1)]),e("div",ee,[e("button",{onClick:q=>O(s.id),class:"btn-success px-3 py-1",disabled:m.value}," Approve ",8,te),e("button",{onClick:q=>M(s.id),class:"btn-danger px-3 py-1",disabled:m.value}," Reject ",8,se)])])])}),128))]))])):d("",!0),e("div",oe,[t[15]||(t[15]=e("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Overtime History",-1)),R.value?(o(),a("div",ae,"Loading...")):v.value.length===0?(o(),a("div",re," No overtime requests found ")):(o(),a("div",le,[e("table",ne,[e("thead",null,[e("tr",null,[t[10]||(t[10]=e("th",null,"Date",-1)),t[11]||(t[11]=e("th",null,"Hours",-1)),t[12]||(t[12]=e("th",null,"Project",-1)),t[13]||(t[13]=e("th",null,"Status",-1)),t[14]||(t[14]=e("th",null,"Reason",-1)),p.value?(o(),a("th",ie,"Employee")):d("",!0),p.value?(o(),a("th",de,"Actions")):d("",!0)])]),e("tbody",null,[(o(!0),a(S,null,$(v.value,s=>{var y,g;return o(),a("tr",{key:s.id},[e("td",null,l(s.date),1),e("td",null,l(s.hours),1),e("td",null,l(s.project||"N/A"),1),e("td",null,[e("span",{class:D(["badge",A(s.status)])},l(s.status),3)]),e("td",null,l(s.reason),1),p.value?(o(),a("td",ue,l((y=s.user)==null?void 0:y.first_name)+" "+l((g=s.user)==null?void 0:g.last_name),1)):d("",!0),p.value?(o(),a("td",ce,[s.status==="pending"?(o(),a("div",ve,[e("button",{onClick:q=>O(s.id),class:"btn-success px-2 py-1 text-xs"},"Approve",8,me),e("button",{onClick:q=>M(s.id),class:"btn-danger px-2 py-1 text-xs"},"Reject",8,pe)])):d("",!0)])):d("",!0)])}),128))])])]))])]))}},xe=E(ye,[["__scopeId","data-v-5c16cd9d"]]);export{xe as default};
