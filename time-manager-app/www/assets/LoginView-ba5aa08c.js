import{o as d,c as u,a as e,b as f,F as k,r as C,t as m,n as U,w as E,v as z,d as _,e as L,u as B,f as p,g as A,h as M,i as S,j as T,k as V}from"./index-8e6e1e8d.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";const R={name:"LoginPage",props:{users:{type:Array,default:()=>[]},usersLoading:{type:Boolean,default:!1},usersError:{type:String,default:""},loginError:{type:String,default:""}},data(){return{selectedUser:null,signinForm:{password:""}}},methods:{initials(r){return r?(r.first_name||r.username||r.email||"").split(" ").map(n=>n?n[0].toUpperCase():"").slice(0,2).join(""):"??"},displayName(r){return r?r.first_name||r.username||r.email||"User":"Unknown User"},selectUser(r){this.selectedUser=r,this.signinForm.password="",this.$nextTick(()=>{const t=document.getElementById("signin_password");t&&t.focus()})},async testBackendConnection(){console.log("--- Bouton cliquÃ© : Tentative de connexion au backend... ---");try{console.log("ðŸ”„ Tentative de requÃªte vers l'URL :","http://192.168.1.248:4000/api/users");const t=await fetch("http://192.168.1.248:4000/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:{username:"AnewTestUserName",email:"testazeza@example.com"}})});if(console.log("RÃ©ponse brute reÃ§ue, statut :",t.status),t.ok){const n=await t.json();console.log("SUCCÃˆS ! DonnÃ©es reÃ§ues :",n),alert("Connexion au backend RÃ‰USSIE ! VÃ©rifiez la console.")}else console.error("ERREUR : Le serveur a rÃ©pondu avec un statut d'Ã©chec :",t.status),alert(`ERREUR : Le serveur a rÃ©pondu avec le code ${t.status}. VÃ©rifiez la console.`)}catch(r){console.error("Ã‰CHEC TOTAL : Impossible de joindre le serveur. L'URL est-elle correcte ? Le serveur est-il dÃ©marrÃ© ? Le tÃ©lÃ©phone est-il sur le bon WiFi ?",r),alert("Ã‰CHEC TOTAL de la connexion. VÃ©rifiez la console pour les dÃ©tails.")}},handleSignin(){!this.selectedUser||!this.signinForm.password||this.$emit("signin",{email:this.selectedUser.email,password:this.signinForm.password})}},watch:{selectedUser(){this.signinForm.password=""},users(){this.selectedUser=null}}},F={class:"space-y-6"},N={key:0},P={class:"mt-4"},H={key:0,class:"space-y-4"},I={key:1,class:"rounded-md bg-red-50 p-4 mb-4"},D={class:"flex"},O={class:"ml-3"},q={class:"text-sm font-medium text-red-800"},W={key:2,class:"space-y-3"},J=["onClick"],$={class:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-medium"},G={class:"ml-4 text-left flex-1 min-w-0"},K={class:"flex items-center justify-between"},Q={class:"text-sm font-medium text-gray-900 truncate"},X={class:"text-sm text-gray-500 truncate"},Y={key:3,class:"text-center py-8"},Z={class:"mt-6"},ee={key:1},te={class:"flex items-center justify-between mb-6"},se={class:"flex items-center p-4 bg-indigo-50 rounded-lg mb-6"},oe={class:"flex-shrink-0 h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-medium text-lg"},re={class:"ml-4"},ne={class:"text-sm font-medium text-gray-900"},ie={class:"text-sm text-gray-500"},le={class:"mt-1 relative rounded-md shadow-sm"},ae={key:0,class:"mt-1 text-sm text-red-600"},de=["disabled"];function ue(r,t,n,y,a,c){return d(),u("div",F,[a.selectedUser?(d(),u("div",ee,[e("div",te,[t[13]||(t[13]=e("h2",{class:"text-2xl font-bold text-gray-900"},"Welcome back",-1)),e("button",{type:"button",onClick:t[2]||(t[2]=s=>a.selectedUser=null),class:"text-sm font-medium text-indigo-600 hover:text-indigo-500 focus:outline-none"}," Change user ")]),e("div",se,[e("div",oe,m(c.initials(a.selectedUser)),1),e("div",re,[e("p",ne,m(c.displayName(a.selectedUser)),1),e("p",ie,m(a.selectedUser.email),1)])]),e("form",{onSubmit:t[4]||(t[4]=L((...s)=>c.handleSignin&&c.handleSignin(...s),["prevent"])),class:"space-y-6"},[e("div",null,[t[15]||(t[15]=e("label",{for:"signin_password",class:"block text-sm font-medium text-gray-700 mb-1"}," Password ",-1)),e("div",le,[E(e("input",{id:"signin_password","onUpdate:modelValue":t[3]||(t[3]=s=>a.signinForm.password=s),type:"password",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200",placeholder:"Enter your password"},null,512),[[z,a.signinForm.password]]),t[14]||(t[14]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"})])],-1))]),n.loginError?(d(),u("div",ae,m(n.loginError),1)):_("",!0),t[16]||(t[16]=e("div",{class:"mt-2 text-right"},[e("a",{href:"#",class:"text-sm font-medium text-indigo-600 hover:text-indigo-500"}," Forgot password? ")],-1))]),e("div",null,[e("button",{type:"submit",class:U(["w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-blue-700 hover:from-indigo-700 hover:to-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200",{"opacity-75 cursor-not-allowed":!a.signinForm.password}]),disabled:!a.signinForm.password},[...t[17]||(t[17]=[e("svg",{class:"h-5 w-5 mr-2 -ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})],-1),f(" Sign in ",-1)])],10,de)])],32)])):(d(),u("div",N,[t[12]||(t[12]=e("div",{class:"text-center mb-6"},[e("h2",{class:"text-2xl font-bold text-gray-900"},"Select an account test"),e("p",{class:"mt-1 text-sm text-gray-500"},"Choose an account to continue")],-1)),e("div",P,[e("button",{type:"button",onClick:t[0]||(t[0]=s=>c.testBackendConnection()),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[...t[5]||(t[5]=[e("svg",{class:"-ml-0.5 mr-2 h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1),f(" Refresh List ",-1)])])]),n.usersLoading?(d(),u("div",H,[(d(),u(k,null,C(3,s=>e("div",{key:`skeleton-${s}`,class:"animate-pulse"},[...t[6]||(t[6]=[e("div",{class:"h-16 bg-gray-100 rounded-lg"},null,-1)])])),64))])):n.usersError?(d(),u("div",I,[e("div",D,[t[7]||(t[7]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",O,[e("h3",q,m(n.usersError),1)])])])):n.users&&n.users.length?(d(),u("div",W,[(d(!0),u(k,null,C(n.users,(s,x)=>{var h,w;return d(),u("button",{key:x,onClick:b=>c.selectUser(s),class:"w-full flex items-center p-4 rounded-lg border border-gray-200 hover:border-indigo-300 hover:bg-indigo-50 transition-colors duration-200"},[e("div",$,m(c.initials(s)),1),e("div",G,[e("div",K,[e("p",Q,m(c.displayName(s)),1),e("span",{class:U(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-purple-100 text-purple-800":((h=s.role)==null?void 0:h.toLowerCase())==="admin","bg-blue-100 text-blue-800":((w=s.role)==null?void 0:w.toLowerCase())==="user","bg-gray-100 text-gray-800":!s.role}])},m(s.role?s.role.toUpperCase():"USER"),3)]),e("p",X,m(s.email),1)])],8,J)}),128))])):(d(),u("div",Y,[t[9]||(t[9]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)),t[10]||(t[10]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No users found",-1)),t[11]||(t[11]=e("p",{class:"mt-1 text-sm text-gray-500"}," Get started by creating a new account. ",-1)),e("div",Z,[e("button",{type:"button",onClick:t[1]||(t[1]=s=>r.$emit("switch-page","signup")),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[...t[8]||(t[8]=[e("svg",{class:"-ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),f(" New Account ",-1)])])])]))]))])}const ce=j(R,[["render",ue],["__scopeId","data-v-edbe8885"]]),me={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4"},ge={class:"w-full max-w-md"},ve={class:"text-center mb-8"},fe={key:0,class:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg"},pe={class:"flex"},xe={class:"ml-3"},he={class:"text-sm font-medium text-green-800"},we={key:0,class:"text-sm text-green-700 mt-1"},ye={class:"bg-white rounded-xl shadow-md overflow-hidden"},be={class:"p-8"},_e={class:"mt-6 text-center"},ke={class:"text-sm text-gray-600"},Le={__name:"LoginView",setup(r){const t=B(),n=p(!1),y=p(""),a=p(""),c=p(!1),s=p(null),x=p([]);A(async()=>{n.value=!0;try{const l=await M.list();x.value=Array.isArray(l)?l:Array.isArray(l==null?void 0:l.data)?l.data:[]}catch{y.value="Failed to load users"}finally{n.value=!1}});const h=async({email:l,password:i})=>{if(a.value="",c.value=!1,!l||!i){a.value="Please enter both email and password";return}try{if(!await w(l,i)){a.value="Invalid email or password";return}const o=x.value.find(v=>v.email===l);if(o){const v={id:o.id,email:o.email,username:o.username,first_name:o.first_name,last_name:o.last_name,role:o.role};localStorage.setItem("currentUser",JSON.stringify(v)),s.value=v}c.value=!0,setTimeout(()=>t.push("/dashboard"),1500)}catch(g){console.error("Login error:",g),a.value=g.message||"An error occurred during login. Please try again."}},w=async(l,i)=>{var g;try{const o=await V.post("/api/sessions",{email:l,password:i});return(g=o==null?void 0:o.data)!=null&&g.token?(localStorage.setItem("authToken",o.data.token),!0):!1}catch(o){throw console.error("Authentication error:",o),o}},b=l=>{l==="signup"&&t.push("/signup")};return(l,i)=>{var g,o,v;return d(),u("div",me,[e("div",ge,[e("div",ve,[i[3]||(i[3]=S('<div class="mx-auto w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><h1 class="text-3xl font-bold text-gray-900 mb-2">Time Manager</h1><p class="text-gray-600">Sign in to access your dashboard</p>',3)),c.value?(d(),u("div",fe,[e("div",pe,[i[2]||(i[2]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-green-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),e("div",xe,[e("p",he," Welcome back, "+m(((g=s.value)==null?void 0:g.first_name)||((o=s.value)==null?void 0:o.username)||"User")+"! ",1),(v=s.value)!=null&&v.role?(d(),u("p",we," Role: "+m(s.value.role.toUpperCase()),1)):_("",!0),i[1]||(i[1]=S('<p class="text-sm text-green-700 mt-2"><span class="inline-flex items-center"><svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Redirecting... </span></p>',1))])])])):_("",!0)]),e("div",ye,[e("div",be,[T(ce,{users:x.value,usersLoading:n.value,usersError:y.value,loginError:a.value,onSignin:h,onSwitchPage:b},null,8,["users","usersLoading","usersError","loginError"])]),i[4]||(i[4]=e("div",{class:"bg-gray-50 px-6 py-4 border-t border-gray-200"},[e("p",{class:"text-xs text-center text-gray-500"},[f(" By signing in, you agree to our "),e("a",{href:"#",class:"text-indigo-600 hover:text-indigo-500 font-medium"},"Terms"),f(" and "),e("a",{href:"#",class:"text-indigo-600 hover:text-indigo-500 font-medium"},"Privacy Policy"),f(". ")])],-1))]),e("div",_e,[e("p",ke,[i[5]||(i[5]=f(" Don't have an account? ",-1)),e("a",{href:"#",onClick:i[0]||(i[0]=L(Ce=>b("signup"),["prevent"])),class:"font-medium text-indigo-600 hover:text-indigo-500"}," Sign up for free ")])])])])}}};export{Le as default};
