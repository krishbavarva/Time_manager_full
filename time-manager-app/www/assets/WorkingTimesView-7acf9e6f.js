import{f as x,g as E,o as a,q as j,s as K,c as i,a as s,t as _,n as Q,d as I,T as X,x as O,l as Z,y as ee,e as te,F as N,r as F,b as se,z as H,w as M,A as oe,v as $}from"./index-8c8fe868.js";import{w as B}from"./workingTimes-95a42894.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";const re={class:"notification-content"},ne={class:"icon"},ae={key:0,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},le={key:1,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ie={class:"message"},ce={__name:"Notification",props:{message:{type:String,required:!0},type:{type:String,default:"info",validator:h=>["success","error","info","warning"].includes(h)},duration:{type:Number,default:3e3}},setup(h,{expose:S}){const p=h,m=x(!1);let d=null;const c=()=>{m.value=!0,p.duration>0&&(clearTimeout(d),d=setTimeout(y,p.duration))},y=()=>{m.value=!1,clearTimeout(d)};return S({show:c,hide:y}),E(()=>{c()}),(T,w)=>(a(),j(X,{name:"fade"},{default:K(()=>[m.value?(a(),i("div",{key:0,class:Q(["notification",h.type])},[s("div",re,[s("span",ne,[h.type==="success"?(a(),i("svg",ae,[...w[0]||(w[0]=[s("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,-1),s("polyline",{points:"22 4 12 14.01 9 11.01"},null,-1)])])):(a(),i("svg",le,[...w[1]||(w[1]=[s("circle",{cx:"12",cy:"12",r:"10"},null,-1),s("line",{x1:"12",y1:"8",x2:"12",y2:"12"},null,-1),s("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"},null,-1)])]))]),s("div",ie,_(h.message),1),s("button",{class:"close-btn",onClick:y,"aria-label":"Close notification"}," Ã— ")])],2)):I("",!0)]),_:1}))}},de=z(ce,[["__scopeId","data-v-ff70bccc"]]);const ue={class:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8"},me={class:"max-w-5xl mx-auto"},ge={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6"},fe={class:"space-y-1 mb-6"},he={class:"flex items-center min-w-[140px] font-medium text-gray-900 cursor-pointer"},pe=["onUpdate:modelValue"],ye={class:"select-none"},we={key:0,class:"flex items-center gap-3 flex-1 sm:ml-4"},be=["onUpdate:modelValue","disabled"],ve=["onUpdate:modelValue","disabled"],xe={class:"flex justify-end pt-4"},ke=["disabled"],_e={key:0,class:"flex items-center gap-2"},Se={key:1},Te={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},De={key:0,class:"flex justify-center items-center py-12"},Ne={key:1,class:"text-center py-12"},Me={key:2,class:"space-y-2"},Ie={class:"flex items-center gap-2"},Ve={class:"font-medium text-gray-900"},Ce={class:"flex items-center gap-4 sm:ml-auto"},Ue={class:"flex items-center gap-2 text-gray-700"},We={class:"text-sm font-medium"},Oe={class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Fe={__name:"WorkingTimesView",setup(h){const S=x(!1),p=x(!1),m=x(""),d=x(""),c=O({show:!1,message:"",duration:3e3}),y=x(null),T=x(null),w=async()=>{var o,e;try{const t=new Date,r=t.toLocaleDateString("en-US",{weekday:"long"}),l=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),g=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999),u=await B.list(d.value,{limit:1,sort:"-start_time",start:l.toISOString(),end:g.toISOString()});if(!(((o=u==null?void 0:u.data)==null?void 0:o.length)>0&&!u.data[0].end_time))return console.log("User is not clocked in - no alert needed"),!1;if(!(((e=n[r])==null?void 0:e.enabled)&&n[r].endTime))return console.log("No working hours set for today - no alert"),!1;const v=t.getHours()*60+t.getMinutes(),[q,R]=n[r].endTime.split(":").map(Number),G=q*60+R;return v>=G?(console.log("Working time has ended - showing alert to user"),alert("You are still clocked in. Your working time has ended. Please remember to clock out!"),D("Your working time has ended. Please remember to clock out!","warning",1e4),!0):(console.log("Working time has not ended yet"),!1)}catch(t){return console.error("Error in working time alert check:",t),!1}},D=(o,e="success",t=3e3)=>{c.message=o,c.type=e,c.duration=t,c.show=!0,H(()=>{y.value&&y.value.show()})},k=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Y=k.reduce((o,e)=>(o[e]={enabled:!1,startTime:"09:00",endTime:"17:00"},o),{}),n=O(JSON.parse(JSON.stringify(Y))),V=Z(()=>{var t;const o={},e=new Date;for(let r=0;r<7;r++){const l=new Date(e);l.setDate(e.getDate()+r);const g=k[l.getDay()===0?6:l.getDay()-1];if((t=n[g])!=null&&t.enabled){const u=l.toISOString().split("T")[0],b=n[g].startTime,f=n[g].endTime,v=A(b,f);o[u]={startTime:b,endTime:f,workingMinutes:v,isWithinWorkingHours:U(b)&&U(f),formattedDuration:J(v)}}}return o}),C=o=>{if(!o)return"--";if(typeof o=="string"&&o.match(/^\d{2}:\d{2}$/)){const[t,r]=o.split(":"),l=new Date;return l.setHours(parseInt(t),parseInt(r)),l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}const e=new Date(o);return isNaN(+e)?String(o):e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})},P=o=>{const e=new Date(o),t=new Date,r=new Date(t);return r.setDate(r.getDate()+1),e.toDateString()===t.toDateString()?"Today":e.toDateString()===r.toDateString()?"Tomorrow":e.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})},U=o=>{if(!o)return!1;try{const[e,t]=o.split(":").map(Number),r=e*60+t;return r>=540&&r<=1020}catch(e){return console.error("Error checking working hours for time:",o,e),!1}},A=(o,e)=>{if(!o||!e)return 0;try{const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),...o.split(":").map(Number)),l=new Date(t.getFullYear(),t.getMonth(),t.getDate(),...e.split(":").map(Number));return Math.abs(l-r)/6e4}catch(t){return console.error("Error calculating working minutes:",{start:o,end:e},t),0}},J=o=>{if(o<=0)return"0h 0m";const e=Math.floor(o/60),t=o%60;return`${e}h ${t}m`},L=async()=>{S.value=!0,m.value="";try{if(!d.value)return;const o=localStorage.getItem(`user_${d.value}_schedule`);if(o){const e=JSON.parse(o);k.forEach(t=>{e[t]&&(n[t]={enabled:e[t].enabled!==void 0?e[t].enabled:!1,startTime:e[t].startTime||"09:00",endTime:e[t].endTime||"17:00"})})}else try{const e=await B.list(d.value);e&&e.data&&console.log("Fetched schedule from API:",e.data)}catch(e){console.warn("Could not fetch schedule from API, using default:",e)}}catch(o){console.error("Failed to load schedule:",o),m.value="Failed to load schedule"}finally{S.value=!1}},W=async o=>{o&&o.preventDefault(),p.value=!0,m.value="";try{if(!d.value)throw new Error("User not logged in");const e=k.filter(r=>{if(!n[r].enabled)return!1;const l=n[r].startTime,g=n[r].endTime;if(!l||!g)return!0;const[u,b]=l.split(":").map(Number),[f,v]=g.split(":").map(Number);return!!(isNaN(u)||isNaN(b)||isNaN(f)||isNaN(v)||f<u||f===u&&v<=b)});if(e.length>0)throw new Error(`Invalid time range for: ${e.join(", ")}. End time must be after start time.`);const t={};k.forEach(r=>{t[r]={enabled:n[r].enabled,startTime:n[r].startTime,endTime:n[r].endTime}}),localStorage.setItem(`user_${d.value}_schedule`,JSON.stringify(t)),D("Schedule saved successfully!","success")}catch(e){console.error("Failed to save schedule:",e);const t=e.message||"Failed to save schedule. Please check your input.";m.value=t,await H();const r=document.querySelector(".error");r&&r.scrollIntoView({behavior:"smooth",block:"center"}),D(t,"error",5e3)}finally{p.value=!1}};return E(async()=>{try{const o=JSON.parse(localStorage.getItem("currentUser")||"null");if(o!=null&&o.id)d.value=String(o.id),await L();else{m.value="Please log in to manage your schedule";return}let e=JSON.stringify(n);const t=setInterval(()=>{const r=JSON.stringify(n);r!==e&&(W(),e=r)},3e4);T.value=setInterval(async()=>{await w()},6e4),await w(),ee(()=>{clearInterval(t),T.value&&clearInterval(T.value)})}catch(o){console.error("Error loading user data:",o),o.value="Failed to load user data. Please refresh the page.",D("Failed to load schedule","error")}}),(o,e)=>(a(),i(N,null,[s("section",ue,[s("div",me,[e[9]||(e[9]=s("div",{class:"mb-8"},[s("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"Daily Schedule"),s("p",{class:"text-gray-600"},"Manage your weekly working hours and view upcoming schedule")],-1)),s("div",ge,[e[3]||(e[3]=s("div",{class:"mb-6"},[s("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Set Your Weekly Schedule"),s("p",{class:"text-sm text-gray-600"},"Define your regular working hours for each day of the week.")],-1)),s("form",{onSubmit:te(W,["prevent"])},[s("div",fe,[(a(),i(N,null,F(k,t=>s("div",{key:t,class:"flex flex-col sm:flex-row sm:items-center py-4 border-b border-gray-200 last:border-b-0 gap-3"},[s("label",he,[M(s("input",{type:"checkbox","onUpdate:modelValue":r=>n[t].enabled=r,class:"w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-2 focus:ring-blue-500 mr-3 cursor-pointer"},null,8,pe),[[oe,n[t].enabled]]),s("span",ye,_(t),1)]),n[t].enabled?(a(),i("div",we,[M(s("input",{type:"time","onUpdate:modelValue":r=>n[t].startTime=r,disabled:!n[t].enabled,required:"",class:"flex-1 py-2 px-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed"},null,8,be),[[$,n[t].startTime]]),e[1]||(e[1]=s("span",{class:"text-gray-500 text-sm font-medium"},"to",-1)),M(s("input",{type:"time","onUpdate:modelValue":r=>n[t].endTime=r,disabled:!n[t].enabled,required:"",class:"flex-1 py-2 px-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed"},null,8,ve),[[$,n[t].endTime]])])):I("",!0)])),64))]),s("div",xe,[s("button",{type:"submit",disabled:p.value,class:"px-6 py-2.5 bg-blue-600 text-white font-medium rounded-lg transition-all duration-200 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:bg-blue-600 shadow-sm"},[p.value?(a(),i("span",_e,[...e[2]||(e[2]=[s("svg",{class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),se(" Saving... ",-1)])])):(a(),i("span",Se,"Save Schedule"))],8,ke)])],32)]),s("div",Te,[e[8]||(e[8]=s("div",{class:"mb-6"},[s("h2",{class:"text-xl font-semibold text-gray-900 mb-2"},"Upcoming Schedule"),s("p",{class:"text-sm text-gray-600"},"Your scheduled working hours for the next 7 days")],-1)),S.value?(a(),i("div",De,[...e[4]||(e[4]=[s("div",{class:"flex items-center gap-3 text-gray-500"},[s("svg",{class:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),s("span",null,"Loading schedule...")],-1)])])):Object.keys(V.value).length===0?(a(),i("div",Ne,[...e[5]||(e[5]=[s("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),s("p",{class:"text-gray-600 text-sm"},"No upcoming schedule",-1),s("p",{class:"text-gray-500 text-xs mt-1"},"Please set your weekly schedule above",-1)])])):(a(),i("div",Me,[(a(!0),i(N,null,F(V.value,(t,r)=>(a(),i("div",{key:r,class:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-4 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50/50 transition-all duration-150 gap-2"},[s("div",Ie,[e[6]||(e[6]=s("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),s("span",Ve,_(P(r)),1)]),s("div",Ce,[s("div",Ue,[e[7]||(e[7]=s("svg",{class:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),s("span",We,_(C(t.startTime))+" - "+_(C(t.endTime)),1)]),s("span",Oe,_(t.formattedDuration),1)])]))),128))]))])])]),c.show?(a(),j(de,{key:0,ref_key:"notificationRef",ref:y,message:c.message,type:c.type,duration:c.duration,onClose:e[0]||(e[0]=t=>c.show=!1)},null,8,["message","type","duration"])):I("",!0)],64))}},Ee=z(Fe,[["__scopeId","data-v-d2d2b8cc"]]);export{Ee as default};
