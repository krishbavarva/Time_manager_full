import{r as f,f as O,g as et,A as M,o as d,c as r,a as t,t as a,F as E,i as N,w as st,v as ot,d as at,n as R,b as W}from"./index-621cd5fc.js";import{t as lt}from"./teams-0f7ee716.js";import"./http-f1abb376.js";import"./users-a5fc0dd3.js";const nt={class:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8"},it={class:"max-w-7xl mx-auto"},dt={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},rt={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ct={class:"flex items-center"},ut={class:"ml-4"},gt={class:"text-2xl font-bold text-gray-900"},xt={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},pt={class:"flex items-center"},mt={class:"ml-4"},yt={class:"text-2xl font-bold text-gray-900"},_t={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},ht={class:"flex items-center"},vt={class:"ml-4"},ft={class:"text-2xl font-bold text-gray-900"},wt={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},bt={class:"flex items-center"},kt={class:"ml-4"},St={class:"text-2xl font-bold text-gray-900"},Dt={class:"bg-white rounded-xl shadow-sm border border-gray-200"},Tt={class:"p-6"},Mt={class:"overflow-x-auto"},Ct={class:"min-w-full divide-y divide-gray-200"},Lt={class:"bg-white divide-y divide-gray-200"},Rt={class:"px-6 py-4 whitespace-nowrap"},It={class:"flex items-center"},$t={class:"flex-shrink-0 h-10 w-10"},Ot={class:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center"},Et={class:"text-sm font-medium text-gray-700"},Nt={class:"ml-4"},At={class:"text-sm font-medium text-gray-900"},Ht={class:"text-sm text-gray-500"},Vt={class:"px-6 py-4 whitespace-nowrap"},Ft={class:"flex items-center"},Pt={class:"text-sm text-gray-900"},Ut={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Wt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Yt=["onClick"],jt={key:1,class:"text-gray-400"},qt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},zt={class:"flex items-center space-x-2"},Qt=["onClick"],Jt={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Kt={class:"relative top-5 mx-auto p-5 border w-full max-w-6xl shadow-lg rounded-md bg-white"},Gt={class:"mt-3"},Xt={class:"flex items-center justify-between mb-6"},Zt={class:"text-xl font-medium text-gray-900"},te={class:"mb-6 p-4 bg-gray-50 rounded-lg"},ee={class:"flex items-center space-x-4"},se={class:"flex items-end"},oe=["disabled"],ae={key:0,class:"flex justify-center items-center py-8"},le={key:1,class:"space-y-6"},ne={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ie={class:"bg-white border border-gray-200 rounded-lg p-4"},de={class:"space-y-3"},re={class:"text-sm font-medium"},ce={class:"text-sm font-medium"},ue={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"},ge={class:"bg-white border border-gray-200 rounded-lg p-4"},xe={class:"space-y-3"},pe={class:"text-sm font-medium"},me={class:"flex items-center"},ye={class:"text-sm font-medium"},_e={class:"text-sm font-medium"},he={class:"text-sm font-medium"},ve={class:"bg-white border border-gray-200 rounded-lg p-4"},fe={class:"space-y-3"},we={key:0},be={class:"text-sm font-medium"},ke={key:1},Se={class:"text-sm font-medium"},De={key:2},Te={class:"bg-white border border-gray-200 rounded-lg p-4"},Me={class:"font-medium text-gray-900 mb-4"},Ce={key:0,class:"overflow-x-auto"},Le={class:"min-w-full divide-y divide-gray-200"},Re={class:"bg-white divide-y divide-gray-200"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},$e={class:"px-6 py-4 whitespace-nowrap"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ee={key:0},Ne={key:1,class:"text-gray-400"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},He={key:1,class:"text-center py-8 text-gray-500"},Ve={class:"bg-white border border-gray-200 rounded-lg p-4"},Fe={key:0,class:"overflow-x-auto"},Pe={class:"min-w-full divide-y divide-gray-200"},Ue={class:"bg-white divide-y divide-gray-200"},We={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},je={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},qe={class:"px-6 py-4 whitespace-nowrap"},ze={key:1,class:"text-center py-8 text-gray-500"},Ze={__name:"ManagerTeamView",setup(Qe){const h=f([]),A=f(!1),g=f(null),m=f(new Date().toISOString().split("T")[0]),S=f(!1),u=f({totalHours:"0:00",clockRecords:[],schedule:[],lastLocation:null,lastClockLocation:null,lastClockTime:null}),B=f(JSON.parse(localStorage.getItem("currentUser")||"{}")),Y=O(()=>h.value.filter(s=>_(s)==="online"||_(s)==="working").length),j=O(()=>h.value.filter(s=>_(s)==="working").length),q=O(()=>{if(h.value.length===0)return"0:00";const e=h.value.reduce((o,l)=>{const i=V(l),[x,v]=i.split(":").map(Number);return o+x+v/60},0)/h.value.length,n=Math.floor(e),c=Math.round((e-n)*60);return`${n}:${c.toString().padStart(2,"0")}`});et(()=>{H()});const H=async()=>{A.value=!0;try{const e=(await lt.getByManager(B.value.id)).data||[],n=[];for(const l of e)l.employees&&n.push(...l.employees);const c=n.filter((l,i,x)=>i===x.findIndex(v=>v.id===l.id)),o=await Promise.all(c.map(async l=>{try{const{clockinsApi:i}=await M(()=>import("./clockins-c9805d20.js"),["assets/clockins-c9805d20.js","assets/http-f1abb376.js"]),{workingTimesApi:x}=await M(()=>import("./workingTimes-d509afa4.js"),["assets/workingTimes-d509afa4.js","assets/http-f1abb376.js"]),I=(await i.listByUser(l.id).catch(()=>({data:[]}))).data||[];if(I.length>0){const y=I[0];l.last_clock_status=y.status,l.last_clock_time=y.time,l.latitude=y.latitude,l.longitude=y.longitude}const D=new Date,w=new Date(D.getFullYear(),D.getMonth(),D.getDate()),b=new Date(w);b.setDate(b.getDate()+1);const T=(await x.list(l.id,w.toISOString(),b.toISOString()).catch(()=>({data:[]}))).data||[];return l.total_hours=T.reduce((y,k)=>{if(k.start&&k.end){const p=new Date(k.start),$=(new Date(k.end)-p)/(1e3*60*60);return y+$}return y},0),l}catch(i){return console.error(`Error loading data for member ${l.id}:`,i),l}}));h.value=o}catch(s){console.error("Error loading team members:",s)}finally{A.value=!1}},z=()=>{H()},_=s=>{if(s.last_clock_status!==void 0){const e=s.last_clock_time?new Date(s.last_clock_time):null;if(e&&(Date.now()-e.getTime())/36e5<12)return s.last_clock_status?"working":"online"}return"offline"},V=s=>{if(s.total_hours!==void 0){const e=Math.floor(s.total_hours),n=Math.round((s.total_hours-e)*60);return`${e}:${n.toString().padStart(2,"0")}`}return"0:00"},Q=s=>s.last_clock_time?new Date(s.last_clock_time).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"No records",J=s=>s.latitude&&s.longitude?`${s.latitude.toFixed(4)}, ${s.longitude.toFixed(4)}`:null,K=s=>{if(s.latitude&&s.longitude){const e=`https://www.google.com/maps?q=${s.latitude},${s.longitude}`;window.open(e,"_blank")}},G=async s=>{g.value=s,await C()},C=async()=>{if(g.value){S.value=!0;try{const{clockinsApi:s}=await M(()=>import("./clockins-c9805d20.js"),["assets/clockins-c9805d20.js","assets/http-f1abb376.js"]),{workingTimesApi:e}=await M(()=>import("./workingTimes-d509afa4.js"),["assets/workingTimes-d509afa4.js","assets/http-f1abb376.js"]),{userSchedulesApi:n}=await M(()=>import("./userSchedules-3c685781.js"),["assets/userSchedules-3c685781.js","assets/http-f1abb376.js"]),c=new Date(m.value+"T00:00:00"),o=new Date(m.value+"T23:59:59"),i=(await s.listByUser(g.value.id,c.toISOString(),o.toISOString()).catch(()=>({data:[]}))).data||[],v=(await e.list(g.value.id,c.toISOString(),o.toISOString()).catch(()=>({data:[]}))).data||[],D=(await n.listByUser(g.value.id).catch(()=>({data:[]}))).data||[];let w=0;v.forEach(p=>{if(p.start&&p.end){const L=new Date(p.start),$=new Date(p.end);w+=($-L)/(1e3*60*60)}});const b=Math.floor(w),U=Math.round((w-b)*60),T=i.find(p=>p.latitude&&p.longitude),y=T?`${T.latitude.toFixed(4)}, ${T.longitude.toFixed(4)}`:null,k=i.length>0?F(i[0].time):null;u.value={totalHours:`${b}:${U.toString().padStart(2,"0")}`,clockRecords:i.sort((p,L)=>new Date(L.time)-new Date(p.time)),schedule:D,lastLocation:y,lastClockLocation:y,lastClockTime:k}}catch(s){console.error("Error loading detailed member data:",s),u.value={totalHours:"0:00",clockRecords:[],schedule:[],lastLocation:null,lastClockLocation:null,lastClockTime:null}}finally{S.value=!1}}},X=s=>{const e=s.target.value,n=new Date;switch(e){case"today":m.value=n.toISOString().split("T")[0];break;case"yesterday":const c=new Date(n);c.setDate(c.getDate()-1),m.value=c.toISOString().split("T")[0];break;case"thisWeek":const o=new Date(n);o.setDate(n.getDate()-n.getDay()),m.value=o.toISOString().split("T")[0];break;case"lastWeek":const l=new Date(n);l.setDate(n.getDate()-n.getDay()-7),m.value=l.toISOString().split("T")[0];break;case"thisMonth":const i=new Date(n.getFullYear(),n.getMonth(),1);m.value=i.toISOString().split("T")[0];break}e&&C()},Z=s=>s?new Date(s).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"No date selected",F=s=>{if(!s)return"No time";const e=new Date(s),n=(e.getMonth()+1).toString().padStart(2,"0"),c=e.getDate().toString().padStart(2,"0"),o=e.getFullYear(),l=e.getHours().toString().padStart(2,"0"),i=e.getMinutes().toString().padStart(2,"0"),x=e.getSeconds().toString().padStart(2,"0");return`${n}/${c}/${o}, ${l}:${i}:${x}`},P=s=>s||"No time",tt=(s,e,n)=>{if(s.status){const c=e.find((o,l)=>l>n&&!o.status);if(c){const o=new Date(s.time),i=(new Date(c.time)-o)/(1e3*60*60),x=Math.floor(i),v=Math.round((i-x)*60);return`${x}:${v.toString().padStart(2,"0")}`}return"In Progress"}return"-"};return(s,e)=>{var n,c;return d(),r("div",nt,[t("div",it,[t("div",{class:"mb-8"},[t("div",{class:"flex items-center justify-between"},[e[2]||(e[2]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"Team Management"),t("p",{class:"text-gray-600"},"Manage your team members and view their working data")],-1)),t("div",{class:"flex items-center space-x-4"},[t("button",{onClick:z,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700"}," 🔄 Refresh ")])])]),t("div",dt,[t("div",rt,[t("div",ct,[e[4]||(e[4]=t("div",{class:"p-3 bg-blue-100 rounded-lg"},[t("span",{class:"text-2xl"},"👥")],-1)),t("div",ut,[e[3]||(e[3]=t("p",{class:"text-sm font-medium text-gray-500"},"Team Members",-1)),t("p",gt,a(h.value.length),1)])])]),t("div",xt,[t("div",pt,[e[6]||(e[6]=t("div",{class:"p-3 bg-green-100 rounded-lg"},[t("span",{class:"text-2xl"},"🟢")],-1)),t("div",mt,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-500"},"Online Now",-1)),t("p",yt,a(Y.value),1)])])]),t("div",_t,[t("div",ht,[e[8]||(e[8]=t("div",{class:"p-3 bg-yellow-100 rounded-lg"},[t("span",{class:"text-2xl"},"⏰")],-1)),t("div",vt,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-gray-500"},"Working Today",-1)),t("p",ft,a(j.value),1)])])]),t("div",wt,[t("div",bt,[e[10]||(e[10]=t("div",{class:"p-3 bg-purple-100 rounded-lg"},[t("span",{class:"text-2xl"},"📊")],-1)),t("div",kt,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-gray-500"},"Avg Hours Today",-1)),t("p",St,a(q.value),1)])])])]),t("div",Dt,[t("div",Tt,[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Team Members",-1)),t("div",Mt,[t("table",Ct,[e[11]||(e[11]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Member"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Today's Hours"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Last Clock"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Location"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Actions")])],-1)),t("tbody",Lt,[(d(!0),r(E,null,N(h.value,o=>{var l,i;return d(),r("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",Rt,[t("div",It,[t("div",$t,[t("div",Ot,[t("span",Et,a((l=o.first_name)==null?void 0:l[0])+a((i=o.last_name)==null?void 0:i[0]),1)])]),t("div",Nt,[t("div",At,a(o.first_name)+" "+a(o.last_name),1),t("div",Ht,a(o.email),1)])])]),t("td",Vt,[t("div",Ft,[t("div",{class:R(["w-2 h-2 rounded-full mr-2",_(o)==="online"?"bg-green-400":_(o)==="working"?"bg-blue-400":"bg-gray-400"])},null,2),t("span",Pt,a(_(o)),1)])]),t("td",Ut,a(V(o)),1),t("td",Wt,a(Q(o)),1),t("td",Bt,[J(o)?(d(),r("button",{key:0,onClick:x=>K(o),class:"text-blue-600 hover:text-blue-800"}," 📍 View ",8,Yt)):(d(),r("span",jt,"No location"))]),t("td",qt,[t("div",zt,[t("button",{onClick:x=>G(o),class:"text-blue-600 hover:text-blue-800",title:"View Details"}," 👁️ ",8,Qt)])])])}),128))])])])])]),g.value?(d(),r("div",Jt,[t("div",Kt,[t("div",Gt,[t("div",Xt,[t("h3",Zt,a(g.value.first_name)+" "+a(g.value.last_name)+" - Team Member Details ",1),t("button",{onClick:e[0]||(e[0]=o=>g.value=null),class:"text-gray-400 hover:text-gray-600 text-2xl"}," ✕ ")]),t("div",te,[t("div",ee,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"View Data For:",-1)),st(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o),type:"date",onInput:C,class:"px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"},null,544),[[ot,m.value]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Quick Select:",-1)),t("select",{onChange:X,class:"px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"},[...e[14]||(e[14]=[at('<option value="">Select Period</option><option value="today">Today</option><option value="yesterday">Yesterday</option><option value="thisWeek">This Week</option><option value="lastWeek">Last Week</option><option value="thisMonth">This Month</option>',6)])],32)]),t("div",se,[t("button",{onClick:C,disabled:S.value,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"},a(S.value?"Loading...":"Refresh Data"),9,oe)])])]),S.value?(d(),r("div",ae,[...e[16]||(e[16]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)])])):(d(),r("div",le,[t("div",ne,[t("div",ie,[e[20]||(e[20]=t("h4",{class:"font-medium text-gray-900 mb-4"},"Basic Information",-1)),t("div",de,[t("div",null,[e[17]||(e[17]=t("label",{class:"text-sm text-gray-500"},"Email",-1)),t("p",re,a(g.value.email),1)]),t("div",null,[e[18]||(e[18]=t("label",{class:"text-sm text-gray-500"},"Username",-1)),t("p",ce,a(g.value.username),1)]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-sm text-gray-500"},"Role",-1)),t("span",ue,a(((n=g.value.role)==null?void 0:n.toUpperCase())||"EMPLOYEE"),1)])])]),t("div",ge,[e[25]||(e[25]=t("h4",{class:"font-medium text-gray-900 mb-4"},"Working Statistics",-1)),t("div",xe,[t("div",null,[e[21]||(e[21]=t("label",{class:"text-sm text-gray-500"},"Total Hours (Selected Date)",-1)),t("p",pe,a(u.value.totalHours||"0:00"),1)]),t("div",null,[e[22]||(e[22]=t("label",{class:"text-sm text-gray-500"},"Current Status",-1)),t("div",me,[t("div",{class:R(["w-2 h-2 rounded-full mr-2",_(g.value)==="online"?"bg-green-400":_(g.value)==="working"?"bg-blue-400":"bg-gray-400"])},null,2),t("span",ye,a(_(g.value)),1)])]),t("div",null,[e[23]||(e[23]=t("label",{class:"text-sm text-gray-500"},"Clock Records Today",-1)),t("p",_e,a(((c=u.value.clockRecords)==null?void 0:c.length)||0)+" entries",1)]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-sm text-gray-500"},"Last Clock",-1)),t("p",he,a(u.value.lastClockTime||"No records"),1)])])]),t("div",ve,[e[29]||(e[29]=t("h4",{class:"font-medium text-gray-900 mb-4"},"Location Information",-1)),t("div",fe,[u.value.lastLocation?(d(),r("div",we,[e[26]||(e[26]=t("label",{class:"text-sm text-gray-500"},"Last Known Location",-1)),t("p",be,a(u.value.lastLocation),1)])):W("",!0),u.value.lastClockLocation?(d(),r("div",ke,[e[27]||(e[27]=t("label",{class:"text-sm text-gray-500"},"Last Clock Location",-1)),t("p",Se,a(u.value.lastClockLocation),1)])):(d(),r("div",De,[...e[28]||(e[28]=[t("p",{class:"text-sm text-gray-500 italic"},"No location data available",-1)])]))])])]),t("div",Te,[t("h4",Me,"Clock-in/out Records for "+a(Z(m.value)),1),u.value.clockRecords&&u.value.clockRecords.length>0?(d(),r("div",Ce,[t("table",Le,[e[30]||(e[30]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Date & Time"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Status"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Location"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Duration")])],-1)),t("tbody",Re,[(d(!0),r(E,null,N(u.value.clockRecords,(o,l)=>(d(),r("tr",{key:o.id},[t("td",Ie,a(F(o.time)),1),t("td",$e,[t("span",{class:R(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",o.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},a(o.status?"Clock In":"Clock Out"),3)]),t("td",Oe,[o.latitude&&o.longitude?(d(),r("span",Ee,a(o.latitude.toFixed(4))+", "+a(o.longitude.toFixed(4)),1)):(d(),r("span",Ne,"No location"))]),t("td",Ae,a(tt(o,u.value.clockRecords,l)),1)]))),128))])])])):(d(),r("div",He," No clock records found for this date "))]),t("div",Ve,[e[32]||(e[32]=t("h4",{class:"font-medium text-gray-900 mb-4"},"Working Schedule",-1)),u.value.schedule&&u.value.schedule.length>0?(d(),r("div",Fe,[t("table",Pe,[e[31]||(e[31]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Day"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Scheduled Start"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Scheduled End"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Scheduled Hours"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Status")])],-1)),t("tbody",Ue,[(d(!0),r(E,null,N(u.value.schedule,o=>(d(),r("tr",{key:o.id},[t("td",We,a(o.day_of_week),1),t("td",Be,a(P(o.scheduled_start_time)),1),t("td",Ye,a(P(o.scheduled_end_time)),1),t("td",je,a(o.scheduled_hours)+"h ",1),t("td",qe,[t("span",{class:R(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",o.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},a(o.is_active?"Active":"Inactive"),3)])]))),128))])])])):(d(),r("div",ze," No working schedule found "))])]))])])])):W("",!0)])])}}};export{Ze as default};
