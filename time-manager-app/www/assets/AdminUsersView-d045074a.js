import{u as x,f as d,g as S,o as n,c as r,a as e,b as U,t as u,F as L,r as $,e as k,w as m,v as p,m as P,d as c,h as y,n as R,p as B}from"./index-829fb2a4.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";const I={class:"admin-users"},z={class:"header"},J={class:"actions"},O={class:"card"},j={key:0,class:"loading"},G={key:1,class:"error"},H={key:2,class:"users-table"},K={class:"actions"},Q=["onClick"],W=["onClick"],X={class:"modal"},Y={class:"form-group"},Z={class:"form-group"},h={class:"form-group"},ee={class:"form-group"},le={class:"form-group"},se={class:"form-group"},te=["required"],ae={key:0},oe={class:"form-actions"},ne={type:"submit",class:"btn-primary"},re={class:"modal"},ie={class:"form-actions"},ue={__name:"AdminUsersView",setup(de){const E=x(),w=d([]),_=d(!0),v=d(""),f=d(!1),o=d(null),i=d(null),C=JSON.parse(localStorage.getItem("currentUser")||"{}"),a=d({first_name:"",last_name:"",email:"",username:"",role:"employee",password:""}),b=async()=>{_.value=!0;try{const s=await y.list();w.value=Array.isArray(s)?s:Array.isArray(s==null?void 0:s.data)?s.data:[]}catch(s){v.value="Failed to load users. Please try again.",console.error("Error loading users:",s)}finally{_.value=!1}},D=async()=>{try{const s={...a.value};o.value&&!s.password&&delete s.password,o.value?await y.update(o.value.id,s):await y.create(s),g(),b()}catch(s){v.value=s.message||"Failed to save user. Please try again.",console.error("Error saving user:",s)}},N=async()=>{if(i.value)try{await y.delete(i.value.id),i.value=null,b()}catch(s){v.value="Failed to delete user. Please try again.",console.error("Error deleting user:",s)}},q=s=>{o.value=s,a.value={first_name:s.first_name,last_name:s.last_name,email:s.email,username:s.username,role:s.role||"employee",password:""}},F=s=>{i.value=s},g=()=>{f.value=!1,o.value=null,a.value={first_name:"",last_name:"",email:"",username:"",role:"employee",password:""}};return S(()=>{if(C.role!=="admin"){E.push("/dashboard");return}b()}),(s,l)=>(n(),r("div",I,[e("div",z,[l[10]||(l[10]=e("h1",null,"User Management",-1)),e("div",J,[e("button",{onClick:l[0]||(l[0]=t=>f.value=!0),class:"btn-primary"},[...l[9]||(l[9]=[e("span",{class:"icon"},"+",-1),U(" Add User ",-1)])])])]),e("div",O,[_.value?(n(),r("div",j,"Loading users...")):v.value?(n(),r("div",G,u(v.value),1)):(n(),r("table",H,[l[11]||(l[11]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Email"),e("th",null,"Role"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),r(L,null,$(w.value,t=>{var A,V;return n(),r("tr",{key:t.id},[e("td",null,u(t.first_name)+" "+u(t.last_name),1),e("td",null,u(t.email),1),e("td",null,[e("span",{class:R(["role-badge",(A=t.role)==null?void 0:A.toLowerCase()])},u(((V=t.role)==null?void 0:V.toUpperCase())||"USER"),3)]),e("td",K,[e("button",{onClick:M=>q(t),class:"icon-btn",title:"Edit"},"✏️",8,Q),B(C).id!==t.id?(n(),r("button",{key:0,onClick:M=>F(t),class:"icon-btn danger",title:"Delete"}," 🗑️ ",8,W)):c("",!0)])])}),128))])]))]),f.value||o.value?(n(),r("div",{key:0,class:"modal-backdrop",onClick:k(g,["self"])},[e("div",X,[e("h2",null,u(o.value?"Edit User":"Add New User"),1),e("form",{onSubmit:k(D,["prevent"])},[e("div",Y,[l[12]||(l[12]=e("label",null,"First Name",-1)),m(e("input",{"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.first_name=t),required:""},null,512),[[p,a.value.first_name]])]),e("div",Z,[l[13]||(l[13]=e("label",null,"Last Name",-1)),m(e("input",{"onUpdate:modelValue":l[2]||(l[2]=t=>a.value.last_name=t),required:""},null,512),[[p,a.value.last_name]])]),e("div",h,[l[14]||(l[14]=e("label",null,"Email",-1)),m(e("input",{"onUpdate:modelValue":l[3]||(l[3]=t=>a.value.email=t),type:"email",required:""},null,512),[[p,a.value.email]])]),e("div",ee,[l[15]||(l[15]=e("label",null,"Username",-1)),m(e("input",{"onUpdate:modelValue":l[4]||(l[4]=t=>a.value.username=t),required:""},null,512),[[p,a.value.username]])]),e("div",le,[l[17]||(l[17]=e("label",null,"Role",-1)),m(e("select",{"onUpdate:modelValue":l[5]||(l[5]=t=>a.value.role=t),required:""},[...l[16]||(l[16]=[e("option",{value:"employee"},"Employee",-1),e("option",{value:"manager"},"Manager",-1),e("option",{value:"admin"},"Administrator",-1)])],512),[[P,a.value.role]])]),e("div",se,[l[18]||(l[18]=e("label",null,"Password",-1)),m(e("input",{"onUpdate:modelValue":l[6]||(l[6]=t=>a.value.password=t),type:"password",required:!o.value},null,8,te),[[p,a.value.password]]),o.value?(n(),r("small",ae,"Leave blank to keep current password")):c("",!0)]),e("div",oe,[e("button",{type:"button",onClick:g,class:"btn-secondary"},"Cancel"),e("button",ne,u(o.value?"Update":"Create")+" User ",1)])],32)])])):c("",!0),i.value?(n(),r("div",{key:1,class:"modal-backdrop",onClick:l[8]||(l[8]=k(t=>i.value=null,["self"]))},[e("div",re,[l[21]||(l[21]=e("h2",null,"Confirm Deletion",-1)),e("p",null,[l[19]||(l[19]=U("Are you sure you want to delete user: ",-1)),e("strong",null,u(i.value.first_name)+" "+u(i.value.last_name),1),l[20]||(l[20]=U("?",-1))]),e("div",ie,[e("button",{onClick:l[7]||(l[7]=t=>i.value=null),class:"btn-secondary"},"Cancel"),e("button",{onClick:N,class:"btn-danger"},"Delete")])])])):c("",!0)]))}},pe=T(ue,[["__scopeId","data-v-961ed4dd"]]);export{pe as default};
