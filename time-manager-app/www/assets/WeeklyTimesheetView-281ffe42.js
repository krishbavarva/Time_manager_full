import{r as y,f as p,g as G,o as x,c as h,a as t,t as a,F as R,i as Y,w as S,v as H,n as q,b as K,e as Q}from"./index-621cd5fc.js";import{workingTimesApi as W}from"./workingTimes-d509afa4.js";import"./http-f1abb376.js";const X={class:"min-h-screen bg-gray-50"},Z={class:"bg-white border-b border-gray-200"},tt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},et={class:"flex items-center justify-between h-16"},st={class:"flex items-center"},ot={class:"ml-4 text-sm text-gray-500"},at={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},nt={class:"mb-6"},rt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4"},it={class:"flex items-center justify-between"},dt={class:"text-lg font-medium text-gray-900"},lt={class:"text-sm text-gray-500"},ct={class:"text-right"},ut={class:"text-2xl font-bold text-indigo-600"},mt={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},pt={class:"bg-gray-50 px-6 py-3 border-b border-gray-200"},gt={class:"flex items-center justify-between"},xt={class:"flex items-center space-x-4"},ht={class:"text-sm text-gray-500"},ft=["disabled"],vt={class:"overflow-x-auto"},_t={class:"min-w-full divide-y divide-gray-200"},wt={class:"bg-white divide-y divide-gray-200"},yt={class:"px-6 py-4 whitespace-nowrap"},bt={class:"flex items-center"},kt={class:"flex-shrink-0"},Tt={class:"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center"},Dt={class:"text-sm font-medium text-indigo-600"},St={class:"ml-3"},Ht={class:"text-sm font-medium text-gray-900"},Ct={class:"text-sm text-gray-500"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Wt={class:"px-6 py-4 whitespace-nowrap"},Nt={class:"flex items-center"},It=["onUpdate:modelValue","onChange"],Et={class:"px-6 py-4 whitespace-nowrap"},$t={class:"flex items-center"},Ut=["onUpdate:modelValue","onChange"],Vt={class:"px-6 py-4 whitespace-nowrap"},jt={class:"flex items-center"},Bt={class:"text-sm font-medium text-gray-900"},Ft={class:"px-6 py-4"},Ot=["onUpdate:modelValue"],At={class:"px-6 py-4 whitespace-nowrap"},Pt={key:0,class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},zt={key:1,class:"w-3 h-3 mr-1 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Jt={class:"bg-orange-50 px-6 py-4 border-t border-orange-200"},Lt={class:"flex items-center justify-between"},Gt={class:"text-2xl font-bold text-orange-600"},Xt={__name:"WeeklyTimesheetView",setup(Rt){const i=y(new Date),d=y([]),f=y(!1),b=y({}),N=p(()=>{const e=g(i.value),s=M(i.value);return`${T(e)} - ${T(s)}`}),I=p(()=>{const e=g(i.value);return $(e)}),k=p(()=>d.value.reduce((e,s)=>e+s.totalHours,0)),C=p(()=>d.value.filter(e=>e.totalHours>0).length);p(()=>{const e=C.value;return e>0?k.value/e:0});const E=p(()=>{const e=C.value*8;return Math.max(0,k.value-e)}),g=e=>{const s=new Date(e),o=s.getDay(),r=s.getDate()-o+(o===0?-6:1);return new Date(s.setDate(r))},M=e=>{const s=g(e),o=new Date(s);return o.setDate(s.getDate()+6),o},$=e=>{const s=new Date(e.getFullYear(),0,1),o=Math.floor((e-s)/(24*60*60*1e3));return Math.ceil((o+s.getDay()+1)/7)},T=e=>e.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),v=e=>{if(!e||e===0)return"00:00:00";const s=Math.floor(e),o=Math.floor((e-s)*60),r=Math.round(((e-s)*60-o)*60);return`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},_=()=>{const e=g(i.value),s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];d.value=[];for(let o=0;o<7;o++){const r=new Date(e);r.setDate(e.getDate()+o),d.value.push({dayNumber:o+1,dayName:s[o],date:r,startTime:"",endTime:"",totalHours:0,comment:"",status:"pending"})}},D=e=>{if(!e.startTime||!e.endTime){e.totalHours=0;return}const s=new Date(`2000-01-01T${e.startTime}`),o=new Date(`2000-01-01T${e.endTime}`);o<s&&o.setDate(o.getDate()+1);const n=(o-s)/(1e3*60*60);e.totalHours=Math.max(0,n),e.status=e.totalHours>0?"completed":"pending"},U=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"submitted":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},V=e=>{switch(e){case"completed":return"Completed";case"pending":return"Pending";case"submitted":return"Submitted";default:return"Unknown"}},j=()=>{i.value=new Date(i.value.getTime()-7*24*60*60*1e3),_(),w()},B=()=>{i.value=new Date(i.value.getTime()+7*24*60*60*1e3),_(),w()},F=()=>{i.value=new Date,_(),w()},w=async()=>{try{const e=JSON.parse(localStorage.getItem("currentUser")||"{}"),s=g(i.value).toISOString().split("T")[0],o=M(i.value).toISOString().split("T")[0],n=(await W.list(e.id,s,o)).data||[];d.value.forEach(u=>{const c=n.find(l=>new Date(l.start||l.start_time||l.startTime).toDateString()===u.date.toDateString());if(c){const l=c.start||c.start_time||c.startTime,m=c.end||c.end_time||c.endTime;if(l&&(u.startTime=new Date(l).toTimeString().slice(0,5)),m&&(u.endTime=new Date(m).toTimeString().slice(0,5)),l&&m){const J=new Date(l),L=new Date(m)-J;u.totalHours=Math.max(0,L/(1e3*60*60))}u.status="completed"}})}catch(e){console.error("Error loading timesheet data:",e)}},O=async()=>{try{f.value=!0;const e=JSON.parse(localStorage.getItem("currentUser")||"{}");for(const s of d.value)if(s.startTime&&s.endTime){const o=new Date(s.date),[r,n]=s.startTime.split(":");o.setHours(parseInt(r),parseInt(n),0,0);const u=new Date(s.date),[c,l]=s.endTime.split(":");u.setHours(parseInt(c),parseInt(l),0,0);const m={start:o.toISOString(),end:u.toISOString()};await W.create(e.id,m)}alert("Timesheet saved successfully!")}catch(e){console.error("Error saving timesheet:",e),alert("Failed to save timesheet. Please try again.")}finally{f.value=!1}},A=()=>{d.value.forEach(e=>{e.dayName!=="Saturday"&&e.dayName!=="Sunday"&&(e.startTime="09:00",e.endTime="18:00",D(e))})},P=()=>{confirm("Are you sure you want to clear all entries?")&&d.value.forEach(e=>{e.startTime="",e.endTime="",e.totalHours=0,e.comment="",e.status="pending"})},z=()=>{alert("PDF export functionality will be implemented soon!")};return G(()=>{const e=JSON.parse(localStorage.getItem("currentUser")||"{}");b.value={name:`${e.first_name||""} ${e.last_name||""}`.trim()||e.username,role:e.role||"employee"},_(),w()}),(e,s)=>(x(),h("div",X,[t("div",Z,[t("div",tt,[t("div",et,[t("div",st,[s[0]||(s[0]=t("h1",{class:"text-xl font-semibold text-gray-900"},"Weekly Timesheet",-1)),t("span",ot,a(N.value),1)]),t("div",{class:"flex items-center space-x-4"},[t("button",{onClick:j,class:"p-2 text-gray-400 hover:text-gray-600"},[...s[1]||(s[1]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("button",{onClick:F,class:"px-3 py-1 text-sm font-medium text-indigo-600 hover:text-indigo-500"}," This Week "),t("button",{onClick:B,class:"p-2 text-gray-400 hover:text-gray-600"},[...s[2]||(s[2]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])])])])]),t("div",at,[t("div",nt,[t("div",rt,[t("div",it,[t("div",null,[t("h2",dt,a(b.value.name),1),t("p",lt,a(b.value.role)+" â€¢ Week "+a(I.value),1)]),t("div",ct,[s[3]||(s[3]=t("p",{class:"text-sm text-gray-500"},"Total Hours This Week",-1)),t("p",ut,a(v(k.value)),1)])])])]),t("div",mt,[t("div",pt,[t("div",gt,[s[4]||(s[4]=t("h3",{class:"text-lg font-medium text-gray-900"},"Weekly Timesheet",-1)),t("div",xt,[t("span",ht,a(d.value.length)+" day(s)",1),t("button",{onClick:O,disabled:f.value,class:"px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md hover:bg-indigo-700 disabled:opacity-50"},a(f.value?"Saving...":"Save Timesheet"),9,ft)])])]),t("div",vt,[t("table",_t,[s[7]||(s[7]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Day "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Start Time "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," End Time "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Work Hours "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Comment "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ")])],-1)),t("tbody",wt,[(x(!0),h(R,null,Y(d.value,(o,r)=>(x(),h("tr",{key:r,class:"hover:bg-gray-50"},[t("td",yt,[t("div",bt,[t("div",kt,[t("div",Tt,[t("span",Dt,a(o.dayNumber),1)])]),t("div",St,[t("div",Ht,a(o.dayName),1),t("div",Ct,"("+a(v(o.totalHours))+")",1)])])]),t("td",Mt,a(T(o.date)),1),t("td",Wt,[t("div",Nt,[S(t("input",{"onUpdate:modelValue":n=>o.startTime=n,type:"time",onChange:n=>D(o),class:"block w-24 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,40,It),[[H,o.startTime]])])]),t("td",Et,[t("div",$t,[S(t("input",{"onUpdate:modelValue":n=>o.endTime=n,type:"time",onChange:n=>D(o),class:"block w-24 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,40,Ut),[[H,o.endTime]])])]),t("td",Vt,[t("div",jt,[t("span",Bt,a(v(o.totalHours)),1)])]),t("td",Ft,[S(t("input",{"onUpdate:modelValue":n=>o.comment=n,type:"text",placeholder:"Add comment...",class:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,8,Ot),[[H,o.comment]])]),t("td",At,[t("span",{class:q([U(o.status),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},[o.status==="completed"?(x(),h("svg",Pt,[...s[5]||(s[5]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):o.status==="pending"?(x(),h("svg",zt,[...s[6]||(s[6]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):K("",!0),Q(" "+a(V(o.status)),1)],2)])]))),128))])])]),t("div",Jt,[t("div",Lt,[s[8]||(s[8]=t("p",{class:"text-sm font-medium text-orange-900"},"Overtime Hours",-1)),t("p",Gt,a(v(E.value)),1)])])]),t("div",{class:"mt-6 flex justify-center space-x-4"},[t("button",{onClick:A,class:"px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-md hover:bg-gray-700"}," Fill Standard Hours (9:00-18:00) "),t("button",{onClick:P,class:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700"}," Clear All "),t("button",{onClick:z,class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700"}," Export PDF ")])])]))}};export{Xt as default};
