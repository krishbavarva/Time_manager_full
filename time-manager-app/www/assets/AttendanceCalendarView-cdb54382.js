import{attendanceApi as J}from"./attendance-2186c79e.js";import{clockinsApi as P}from"./clockins-53d1e946.js";import{_ as T}from"./LoadingSpinner-e7779de2.js";import{r as g,f as w,g as U,o as d,c as v,a as t,q,t as i,n as M,d as z,F,i as N,b as $}from"./index-5e39243b.js";import"./http-8cebfae0.js";const G={class:"min-h-screen bg-gray-50 py-8"},K={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Q={key:1,class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},X={class:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4"},Z={class:"flex items-center justify-between"},ee={class:"text-2xl font-bold text-white"},te=["disabled"],se={class:"p-6"},ae={class:"grid grid-cols-7 gap-2 mb-2"},ne={class:"grid grid-cols-7 gap-2"},re={class:"absolute inset-0 flex flex-col items-center justify-center p-2"},oe={key:0,class:"text-xs mt-1 text-center font-medium text-gray-700"},le={key:1,class:"text-xs mt-1 font-medium"},ie={class:"bg-gray-50 px-6 py-4 border-t border-gray-200"},de={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ce={class:"text-center"},ue={class:"text-2xl font-bold text-green-600"},ve={class:"text-center"},ge={class:"text-2xl font-bold text-red-600"},pe={class:"text-center"},xe={class:"text-2xl font-bold text-yellow-600"},me={class:"text-center"},ye={class:"text-2xl font-bold text-blue-600"},ke={__name:"AttendanceCalendarView",setup(be){const y=g(!0),n=g(new Date().getMonth()),o=g(new Date().getFullYear()),p=g([]),C=g([]),A=g([]),L=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],R=w(()=>["January","February","March","April","May","June","July","August","September","October","November","December"][n.value]),_=w(()=>{const e=new Date;return n.value===e.getMonth()&&o.value===e.getFullYear()}),B=w(()=>{const e=[],s=new Date(o.value,n.value,1),a=new Date(o.value,n.value+1,0),c=s.getDay();for(let r=0;r<c;r++)e.push({key:`empty-${r}`,date:"",isEmpty:!0});for(let r=1;r<=a.getDate();r++){const l=new Date(o.value,n.value,r),x=Y(l),f=l.getDay(),h=f===0||f===6,u=A.value.find(m=>m.date===x),k=p.value.find(m=>m.date===x),I=C.value.some(m=>{const S=new Date(m.time);return S.getFullYear()===o.value&&S.getMonth()===n.value&&S.getDate()===r});e.push({key:`day-${r}`,date:r,dateString:x,isWeekend:h,isHoliday:!!u,holidayReason:(u==null?void 0:u.reason)||"",status:(k==null?void 0:k.status)||(I?"present":null),isFuture:l>new Date})}return e}),b=w(()=>{const e=p.value.filter(l=>l.status==="present").length,s=p.value.filter(l=>l.status==="absent").length,a=p.value.filter(l=>l.status==="on_leave").length,c=e+s,r=c>0?Math.round(e/c*100):0;return{present:e,absent:s,onLeave:a,attendanceRate:r}}),H=e=>e.isEmpty?"border-transparent":e.isFuture?"bg-gray-100 border-gray-200":e.isWeekend||e.isHoliday?"bg-gray-400 border-gray-500":e.status==="present"?"bg-green-500 border-green-600":e.status==="absent"?"bg-red-500 border-red-600":e.status==="on_leave"?"bg-yellow-500 border-yellow-600":"bg-white border-gray-300",O=e=>e.isEmpty||e.isFuture?"text-gray-400":e.isWeekend||e.isHoliday||e.status?"text-white":"text-gray-700",W=e=>({present:"P",absent:"A",on_leave:"L"})[e]||"",Y=e=>{const s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0");return`${s}-${a}-${c}`},E=()=>{n.value===0?(n.value=11,o.value--):n.value--,D()},j=()=>{_.value||(n.value===11?(n.value=0,o.value++):n.value++,D())},D=async()=>{y.value=!0;try{const e=JSON.parse(localStorage.getItem("currentUser")||"{}"),s=new Date(o.value,n.value,1),a=new Date(o.value,n.value+1,0),r=(await J.list()).data||[];p.value=r.filter(h=>{if(h.user_id!==e.id)return!1;const u=new Date(h.date);return u>=s&&u<=a});const l=s.toISOString(),x=a.toISOString(),f=await P.listByUser(e.id,l,x);C.value=f.data||[],V()}catch(e){console.error("Error loading attendance data:",e)}finally{y.value=!1}},V=()=>{const e=o.value;A.value=[{date:`${e}-01-01`,reason:"New Year"},{date:`${e}-12-25`,reason:"Christmas"},{date:`${e}-12-31`,reason:"New Year Eve"}]};return U(()=>{D()}),(e,s)=>(d(),v("div",G,[t("div",K,[s[7]||(s[7]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"My Attendance Calendar"),t("p",{class:"mt-2 text-sm text-gray-600"},"View your monthly attendance record")],-1)),y.value?(d(),q(T,{key:0,show:y.value,text:"Loading attendance data...",size:"lg"},null,8,["show"])):(d(),v("div",Q,[t("div",X,[t("div",Z,[t("button",{onClick:E,class:"p-2 text-white hover:bg-blue-500 rounded-lg transition-colors"},[...s[0]||(s[0]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("h2",ee,i(R.value)+" "+i(o.value),1),t("button",{onClick:j,class:M(["p-2 text-white hover:bg-blue-500 rounded-lg transition-colors",{"opacity-50 cursor-not-allowed":_.value}]),disabled:_.value},[...s[1]||(s[1]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],10,te)])]),s[6]||(s[6]=z('<div class="bg-gray-50 px-6 py-3 border-b border-gray-200"><div class="flex flex-wrap items-center justify-center gap-4 text-sm"><div class="flex items-center"><div class="w-4 h-4 bg-green-500 rounded mr-2"></div><span class="text-gray-700">Present</span></div><div class="flex items-center"><div class="w-4 h-4 bg-red-500 rounded mr-2"></div><span class="text-gray-700">Absent</span></div><div class="flex items-center"><div class="w-4 h-4 bg-yellow-500 rounded mr-2"></div><span class="text-gray-700">On Leave</span></div><div class="flex items-center"><div class="w-4 h-4 bg-gray-400 rounded mr-2"></div><span class="text-gray-700">Weekend/Holiday</span></div><div class="flex items-center"><div class="w-4 h-4 bg-white border-2 border-gray-300 rounded mr-2"></div><span class="text-gray-700">No Data</span></div></div></div>',1)),t("div",se,[t("div",ae,[(d(),v(F,null,N(L,a=>t("div",{key:a,class:"text-center font-semibold text-gray-700 py-2"},i(a),1)),64))]),t("div",ne,[(d(!0),v(F,null,N(B.value,a=>(d(),v("div",{key:a.key,class:M(["relative aspect-square rounded-lg border-2 transition-all duration-200 hover:shadow-md",H(a)])},[t("div",re,[t("span",{class:M(["text-lg font-semibold",O(a)])},i(a.date),3),a.isHoliday?(d(),v("span",oe,i(a.holidayReason),1)):$("",!0),a.status?(d(),v("span",le,i(W(a.status)),1)):$("",!0)])],2))),128))])]),t("div",ie,[t("div",de,[t("div",ce,[t("p",ue,i(b.value.present),1),s[2]||(s[2]=t("p",{class:"text-sm text-gray-600"},"Present Days",-1))]),t("div",ve,[t("p",ge,i(b.value.absent),1),s[3]||(s[3]=t("p",{class:"text-sm text-gray-600"},"Absent Days",-1))]),t("div",pe,[t("p",xe,i(b.value.onLeave),1),s[4]||(s[4]=t("p",{class:"text-sm text-gray-600"},"Leave Days",-1))]),t("div",me,[t("p",ye,i(b.value.attendanceRate)+"%",1),s[5]||(s[5]=t("p",{class:"text-sm text-gray-600"},"Attendance Rate",-1))])])])]))])]))}};export{ke as default};
