import{t as w}from"./teams-0f7ee716.js";import{attendanceApi as k}from"./attendance-a1dc7538.js";import{x as b,o as l,c,a as t,e as x,n as _,t as n,F as f,i as y,b as v}from"./index-621cd5fc.js";import"./http-f1abb376.js";import"./users-a5fc0dd3.js";const T={name:"TeamDataView",data(){return{teamData:null,loading:!1,todayAttendance:[]}},computed:{teamId(){return this.$route.params.id},totalTeamHours(){var s;return(s=this.teamData)!=null&&s.members_data?this.teamData.members_data.reduce((e,r)=>e+(r.total_hours||0),0):0},totalTeamSessions(){var s;return(s=this.teamData)!=null&&s.members_data?this.teamData.members_data.reduce((e,r)=>{var d;return e+(((d=r.working_times)==null?void 0:d.length)||0)},0):0},todayPresentCount(){var s;return(s=this.teamData)!=null&&s.members_data?this.teamData.members_data.filter(e=>e.attendanceStatus==="present").length:0},recentActivity(){var e;if(!((e=this.teamData)!=null&&e.members_data))return[];const s=[];return this.teamData.members_data.forEach(r=>{if(r.working_times&&r.working_times.length>0){const d={};r.working_times.forEach(i=>{const o=new Date(i.start).toDateString();d[o]||(d[o]={hours:0,sessions:0});const m=(new Date(i.end)-new Date(i.start))/(1e3*60*60);d[o].hours+=m,d[o].sessions+=1}),Object.entries(d).forEach(([i,o])=>{s.push({employee:r.employee,date:i,hours:o.hours,sessions:o.sessions})})}}),s.sort((r,d)=>new Date(d.date)-new Date(r.date))}},async created(){await this.loadTeamData()},methods:{async loadTeamData(){var s;try{this.loading=!0;const e=await w.get(this.teamId),r=e.data||e;await this.loadTodayAttendance();const d=(r.employees||[]).map(i=>{const o=this.todayAttendance.find(m=>m.user_id===i.id);return{employee:i,total_hours:0,working_times:[],attendanceStatus:this.getAttendanceStatus(o),attendanceTime:o?new Date(o.inserted_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):null}});this.teamData={team:r,members_data:d}}catch(e){console.error("Error loading team data:",e),(s=this.$toast)==null||s.error("Failed to load team data")}finally{this.loading=!1}},async loadTodayAttendance(){try{const s=new Date().toISOString().split("T")[0],e=await k.list();this.todayAttendance=(e.data||[]).filter(r=>r.date===s)}catch(s){console.error("Error loading attendance:",s),this.todayAttendance=[]}},getAttendanceStatus(s){return s?s.status:"not_marked"},getAttendanceStatusClass(s){switch(s){case"present":return"bg-green-100 text-green-800";case"absent":return"bg-red-100 text-red-800";case"on_leave":return"bg-yellow-100 text-yellow-800";case"not_marked":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-600"}},getAttendanceStatusLabel(s){switch(s){case"present":return"âœ“ Present";case"absent":return"âœ— Absent";case"on_leave":return"ðŸ“… On Leave";case"not_marked":return"- Not Marked";default:return"- Unknown"}},getEmployeeInitials(s){var e,r;return((e=s.first_name)==null?void 0:e[0])||((r=s.username)==null?void 0:r[0])||"U"},formatDate(s){return new Date(s).toLocaleDateString()},goBackToTeams(){(JSON.parse(localStorage.getItem("currentUser")||"{}").role||"employee")==="admin"?this.$router.push("/admin/teams"):this.$router.push("/teams")}}},A={class:"p-6 max-w-7xl mx-auto bg-white"},S={class:"flex items-center justify-between mb-6"},D={class:"flex items-center gap-4"},C={class:"flex gap-3"},B=["disabled"],j={key:0,class:"flex justify-center items-center py-12"},M={key:1,class:"space-y-6"},V={class:"bg-white border border-gray-200 rounded-lg shadow-sm"},z={class:"p-6"},H={class:"text-xl font-semibold text-gray-900 mb-4"},U={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},E={class:"bg-blue-50 p-4 rounded-lg"},L={class:"flex items-center"},F={class:"ml-3"},I={class:"text-2xl font-semibold text-blue-900"},N={class:"bg-green-50 p-4 rounded-lg"},R={class:"flex items-center"},P={class:"ml-3"},O={class:"text-2xl font-semibold text-green-900"},J={class:"bg-orange-50 p-4 rounded-lg"},W={class:"flex items-center"},q={class:"ml-3"},G={class:"text-2xl font-semibold text-orange-900"},K={class:"bg-purple-50 p-4 rounded-lg"},Q={class:"flex items-center"},X={class:"ml-3"},Y={class:"text-2xl font-semibold text-purple-900"},Z={class:"bg-white border border-gray-200 rounded-lg shadow-sm"},$={class:"p-6"},tt={class:"overflow-x-auto"},et={class:"min-w-full divide-y divide-gray-200"},st={class:"bg-white divide-y divide-gray-200"},at={class:"px-6 py-4 whitespace-nowrap"},ot={class:"flex items-center"},nt={class:"flex-shrink-0 h-10 w-10"},rt={class:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center"},it={class:"text-sm font-medium text-gray-700"},dt={class:"ml-4"},lt={class:"text-sm font-medium text-gray-900"},ct={class:"text-sm text-gray-500"},mt={class:"px-6 py-4 whitespace-nowrap"},ut={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},xt={class:"px-6 py-4 whitespace-nowrap"},ht={key:0,class:"text-xs text-gray-500 mt-1"},gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},pt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},_t={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ft=["onClick"],yt={key:0,class:"bg-white border border-gray-200 rounded-lg shadow-sm"},vt={class:"p-6"},wt={class:"space-y-3"},kt={class:"flex-shrink-0"},bt={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},Tt={class:"text-xs font-medium text-blue-600"},At={class:"flex-1"},St={class:"text-sm text-gray-900"},Dt={class:"font-medium"},Ct={class:"text-xs text-gray-500"},Bt={key:2,class:"text-center py-12"};function jt(s,e,r,d,i,o){var m;return l(),c("section",A,[t("div",S,[t("div",D,[t("button",{onClick:e[0]||(e[0]=(...a)=>o.goBackToTeams&&o.goBackToTeams(...a)),class:"flex items-center gap-2 text-gray-600 hover:text-gray-900"},[...e[2]||(e[2]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),x(" Back to Teams ",-1)])]),e[3]||(e[3]=t("div",{class:"h-6 w-px bg-gray-300"},null,-1)),e[4]||(e[4]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Team Analytics",-1))]),t("div",C,[t("button",{onClick:e[1]||(e[1]=(...a)=>o.loadTeamData&&o.loadTeamData(...a)),disabled:i.loading,class:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 disabled:opacity-50"},[(l(),c("svg",{class:_(["w-4 h-4",{"animate-spin":i.loading}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),x(" "+n(i.loading?"Loading...":"Refresh"),1)],8,B)])]),i.loading?(l(),c("div",j,[...e[6]||(e[6]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1)])])):i.teamData?(l(),c("div",M,[t("div",V,[t("div",z,[t("h2",H,n(i.teamData.team.description||"Unnamed Team"),1),t("div",U,[t("div",E,[t("div",L,[e[8]||(e[8]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})])],-1)),t("div",F,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-blue-800"},"Total Members",-1)),t("p",I,n(((m=i.teamData.members_data)==null?void 0:m.length)||0),1)])])]),t("div",N,[t("div",R,[e[10]||(e[10]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",P,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-green-800"},"Present Today",-1)),t("p",O,n(o.todayPresentCount),1)])])]),t("div",J,[t("div",W,[e[12]||(e[12]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-6 w-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",q,[e[11]||(e[11]=t("p",{class:"text-sm font-medium text-orange-800"},"Total Hours",-1)),t("p",G,n(o.totalTeamHours.toFixed(1))+"h",1)])])]),t("div",K,[t("div",Q,[e[14]||(e[14]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-6 w-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])],-1)),t("div",X,[e[13]||(e[13]=t("p",{class:"text-sm font-medium text-purple-800"},"Work Sessions",-1)),t("p",Y,n(o.totalTeamSessions),1)])])])])])]),t("div",Z,[t("div",$,[e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Team Member Performance",-1)),t("div",tt,[t("table",et,[e[15]||(e[15]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Member"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Role"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Today's Attendance"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total Hours"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Sessions"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",st,[(l(!0),c(f,null,y(i.teamData.members_data,a=>{var u,h,g,p;return l(),c("tr",{key:a.employee.id},[t("td",at,[t("div",ot,[t("div",nt,[t("div",rt,[t("span",it,n(((u=a.employee.first_name)==null?void 0:u[0])||((h=a.employee.username)==null?void 0:h[0])||"U"),1)])]),t("div",dt,[t("div",lt,n(a.employee.first_name)+" "+n(a.employee.last_name),1),t("div",ct,n(a.employee.email),1)])])]),t("td",mt,[t("span",ut,n(a.employee.role),1)]),t("td",xt,[t("span",{class:_(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.getAttendanceStatusClass(a.attendanceStatus)])},n(o.getAttendanceStatusLabel(a.attendanceStatus)),3),a.attendanceTime?(l(),c("div",ht,n(a.attendanceTime),1)):v("",!0)]),t("td",gt,n(((g=a.total_hours)==null?void 0:g.toFixed(1))||"0.0")+"h ",1),t("td",pt,n(((p=a.working_times)==null?void 0:p.length)||0),1),t("td",_t,[t("button",{onClick:Mt=>s.$router.push(`/users/${a.employee.id}/working-times`),class:"text-indigo-600 hover:text-indigo-900"}," View Details ",8,ft)])])}),128))])])])])]),o.recentActivity.length>0?(l(),c("div",yt,[t("div",vt,[e[17]||(e[17]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Recent Activity",-1)),t("div",wt,[(l(!0),c(f,null,y(o.recentActivity.slice(0,10),a=>{var u;return l(),c("div",{key:`${a.user_id}-${a.date}`,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},[t("div",kt,[t("div",bt,[t("span",Tt,n(o.getEmployeeInitials(a.employee)),1)])]),t("div",At,[t("p",St,[t("span",Dt,n(a.employee.first_name)+" "+n(a.employee.last_name),1),x(" worked "+n(((u=a.hours)==null?void 0:u.toFixed(1))||"0.0")+" hours on "+n(o.formatDate(a.date)),1)]),t("p",Ct,n(a.sessions||0)+" sessions",1)])])}),128))])])])):v("",!0)])):(l(),c("div",Bt,[...e[18]||(e[18]=[t("svg",{class:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),t("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No data available",-1),t("p",{class:"mt-1 text-sm text-gray-500"},"Unable to load team data or you don't have permission to view it.",-1)])]))])}const Lt=b(T,[["render",jt]]);export{Lt as default};
