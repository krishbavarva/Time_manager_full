<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Users</title>
    <script type="module">
        import { usersApi } from '../src/api/users.js';

        // Sample users with different roles
        const sampleUsers = [
            {
                username: 'admin',
                first_name: 'Admin',
                last_name: 'User',
                email: 'admin@example.com',
                password: 'admin123',
                role: 'admin'
            },
            {
                username: 'manager1',
                first_name: 'Manager',
                last_name: 'One',
                email: 'manager@example.com',
                password: 'manager123',
                role: 'manager'
            },
            {
                username: 'employee1',
                first_name: 'Employee',
                last_name: 'One',
                email: 'employee@example.com',
                password: 'employee123',
                role: 'employee'
            }
        ];

        async function setupUsers() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Starting user setup...</p>';
            
            try {
                // First, get all existing users
                output.innerHTML += '<p>Fetching existing users...</p>';
                const existingUsers = await usersApi.list();
                
                // Delete all existing users
                for (const user of existingUsers) {
                    output.innerHTML += `<p>Deleting user: ${user.username}...</p>`;
                    await usersApi.remove(user.id);
                }
                
                // Create new users
                for (const user of sampleUsers) {
                    output.innerHTML += `<p>Creating user: ${user.username}...</p>`;
                    await usersApi.create(user);
                }
                
                // Show success message with login details
                output.innerHTML += `
                    <h3>Successfully set up users:</h3>
                    <table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%;">
                        <thead>
                            <tr>
                                <th>Role</th>
                                <th>Username</th>
                                <th>Password</th>
                                <th>Email</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sampleUsers.map(u => `
                                <tr>
                                    <td>${u.role}</td>
                                    <td>${u.username}</td>
                                    <td>${u.password}</td>
                                    <td>${u.email}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <p><a href="/login">Go to Login Page</a></p>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                output.innerHTML += `
                    <p style="color: red;">Error setting up users: ${error.message}</p>
                    <p>${error.stack || ''}</p>
                `;
            }
        }

        // Run the setup when the page loads
        window.onload = setupUsers;
    </script>
</head>
<body>
    <div style="max-width: 800px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;">
        <h1>User Setup</h1>
        <p>Setting up default users. Please wait...</p>
        <div id="output" style="margin-top: 20px; padding: 10px; border: 1px solid #ddd; min-height: 100px;">
            Initializing...
        </div>
    </div>
</body>
</html>
